<!DOCTYPE html>
<html lang=en>

<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description"
        content="Ph·∫ßn 2Ch√∫c m·ªçi ng∆∞·ªùi m·ªôt gi√°ng sinh vui v·∫ª üéÑC√πng ƒë·∫øn v·ªõi ph·∫ßn 2 c·ªßa series b√†i v·ªõi 5 th·ª≠ th√°ch:  report (solution) TKApp (solution) codeit (solution) re_crowd (">
    <meta property="og:type" content="article">
    <meta property="og:title" content="FLAREON 2020 - WRITEUP PH·∫¶N 2">
    <meta property="og:url" content="https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/index.html">
    <meta property="og:site_name" content="&#x2F; home &#x2F; cyberjutsu &#x2F; blog &#x2F;">
    <meta property="og:description"
        content="Ph·∫ßn 2Ch√∫c m·ªçi ng∆∞·ªùi m·ªôt gi√°ng sinh vui v·∫ª üéÑC√πng ƒë·∫øn v·ªõi ph·∫ßn 2 c·ªßa series b√†i v·ªõi 5 th·ª≠ th√°ch:  report (solution) TKApp (solution) codeit (solution) re_crowd (">
    <meta property="og:locale" content="en_US">
    <meta property="article:published_time" content="2020-12-23T17:00:01.000Z">
    <meta property="article:modified_time" content="2021-06-04T02:28:13.902Z">
    <meta property="article:author" content="CyberJutsu Team">
    <meta property="article:tag" content="flareon">
    <meta property="article:tag" content="reverse engineering">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="https://blog.cyberjutsu.io/images/flareon/FlareOn@2x.jpg">
    <meta property="og:image" content="https://blog.cyberjutsu.io/images/flareon/FlareOn@2x.jpg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">




    <link rel="shortcut icon" href="/images/favicon.ico">




    <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">




    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">



    <!-- title -->
    <title>FLAREON 2020 - WRITEUP PH·∫¶N 2</title>
    <!-- styles -->

    <link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    <!-- fix bug: by bach' -->
    <!-- 
      
<link rel="stylesheet" href="/css/rtl.css">

     -->
    <!-- rss -->


    <meta name="generator" content="Hexo 5.2.0">
</head>

<body class="max-width mx-auto ltr">

    <div id="header-post">
        <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
        <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
        <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"
            style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
        <span id="menu">
            <span id="nav">
                <ul>

                    <li><a href="/home.html">home</a></li>

                    <li><a href="/about/about.html">about</a></li>

                    <li><a href="/archives/archives.html">articles</a></li>

                    <li><a target="_blank" rel="noopener" href="https://cyberjutsu.io/publications/">publications</a>
                    </li>

                </ul>
            </span>
            <br />
            <span id="actions">
                <ul>

                    <li><a class="icon" href="/2021/01/06/flareon-phan-3.html"><i class="fas fa-chevron-left"
                                aria-hidden="true" onmouseover="$('#i-prev').toggle();"
                                onmouseout="$('#i-prev').toggle();"></i></a></li>


                    <li><a class="icon" href="/2020/12/03/flareon-phan-1.html"><i class="fas fa-chevron-right"
                                aria-hidden="true" onmouseover="$('#i-next').toggle();"
                                onmouseout="$('#i-next').toggle();"></i></a></li>

                    <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i
                                class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();"
                                onmouseout="$('#i-top').toggle();"></i></a></li>
                    <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true"
                                onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();"
                                onclick="$('#share').toggle();return false;"></i></a></li>
                </ul>
                <span id="i-prev" class="info" style="display:none;">Previous post</span>
                <span id="i-next" class="info" style="display:none;">Next post</span>
                <span id="i-top" class="info" style="display:none;">Back to top</span>
                <span id="i-share" class="info" style="display:none;">Share post</span>
            </span>
            <br />
            <div id="share" style="display: none">
                <ul>
                    <li><a class="icon" target="_blank" rel="noopener"
                            href="http://www.facebook.com/sharer.php?u=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/"><i
                                class="fab fa-facebook " aria-hidden="true"></i></a></li>
                    <li><a class="icon" target="_blank" rel="noopener"
                            href="https://twitter.com/share?url=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&text=FLAREON 2020 - WRITEUP PH·∫¶N 2"><i
                                class="fab fa-twitter " aria-hidden="true"></i></a></li>
                    <li><a class="icon" target="_blank" rel="noopener"
                            href="http://www.linkedin.com/shareArticle?url=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&title=FLAREON 2020 - WRITEUP PH·∫¶N 2"><i
                                class="fab fa-linkedin " aria-hidden="true"></i></a></li>
                    <li><a class="icon" target="_blank" rel="noopener"
                            href="https://pinterest.com/pin/create/bookmarklet/?url=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&is_video=false&description=FLAREON 2020 - WRITEUP PH·∫¶N 2"><i
                                class="fab fa-pinterest " aria-hidden="true"></i></a></li>
                    <li><a class="icon"
                            href="mailto:?subject=FLAREON 2020 - WRITEUP PH·∫¶N 2&body=Check out this article: https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/"><i
                                class="fas fa-envelope " aria-hidden="true"></i></a></li>
                    <li><a class="icon" target="_blank" rel="noopener"
                            href="https://getpocket.com/save?url=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&title=FLAREON 2020 - WRITEUP PH·∫¶N 2"><i
                                class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
                    <li><a class="icon" target="_blank" rel="noopener"
                            href="http://reddit.com/submit?url=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&title=FLAREON 2020 - WRITEUP PH·∫¶N 2"><i
                                class="fab fa-reddit " aria-hidden="true"></i></a></li>
                    <li><a class="icon" target="_blank" rel="noopener"
                            href="http://www.stumbleupon.com/submit?url=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&title=FLAREON 2020 - WRITEUP PH·∫¶N 2"><i
                                class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
                    <li><a class="icon" target="_blank" rel="noopener"
                            href="http://digg.com/submit?url=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&title=FLAREON 2020 - WRITEUP PH·∫¶N 2"><i
                                class="fab fa-digg " aria-hidden="true"></i></a></li>
                    <li><a class="icon" target="_blank" rel="noopener"
                            href="http://www.tumblr.com/share/link?url=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&name=FLAREON 2020 - WRITEUP PH·∫¶N 2&description="><i
                                class="fab fa-tumblr " aria-hidden="true"></i></a></li>
                    <li><a class="icon" target="_blank" rel="noopener"
                            href="https://news.ycombinator.com/submitlink?u=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&t=FLAREON 2020 - WRITEUP PH·∫¶N 2"><i
                                class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
                </ul>

            </div>
            <div id="toc">
                <ol class="toc">
                    <li class="toc-item toc-level-2"><a class="toc-link" href="#Phan-2"><span
                                class="toc-number">1.</span> <span class="toc-text">Ph·∫ßn 2</span></a></li>
                </ol>
                </li>
                <li class="toc-item toc-level-1"><a class="toc-link" href="#4-report"><span class="toc-number"></span>
                        <span class="toc-text">4 - report</span></a></li>
                <li class="toc-item toc-level-1"><a class="toc-link" href="#5-TKApp"><span class="toc-number"></span>
                        <span class="toc-text">5 - TKApp</span></a></li>
                <li class="toc-item toc-level-1"><a class="toc-link" href="#6-codeit"><span class="toc-number"></span>
                        <span class="toc-text">6 - codeit</span></a></li>
                <li class="toc-item toc-level-1"><a class="toc-link" href="#7-re-crowd"><span class="toc-number"></span>
                        <span class="toc-text">7 - re_crowd</span></a></li>
                <li class="toc-item toc-level-1"><a class="toc-link" href="#8-Aardvark"><span class="toc-number"></span>
                        <span class="toc-text">8 - Aardvark</span></a>
            </div>
        </span>
    </div>


    <div class="content index py4">

        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
            <header>

                <h1 class="posttitle" itemprop="name headline">
                    FLAREON 2020 - WRITEUP PH·∫¶N 2
                </h1>



                <div class="meta">
                    <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
                        <span itemprop="name">xikhud</span>
                    </span>>>

                    <div class="postdate">

                        <time datetime="2020-12-23T17:00:01.000Z" itemprop="datePublished">2020-12-24</time>


                    </div>





                    <div class="article-tag">
                        <i class="fas fa-tag"></i>
                        <a class="tag-link-link" href="/tags/flareon/" rel="tag">flareon</a>, <a class="tag-link-link"
                            href="/tags/reverse-engineering/" rel="tag">reverse engineering</a>
                    </div>


                </div>
            </header>


            <div class="content" itemprop="articleBody">
                <main>
                    <div class="c-glitch" style="background-image: url('/images/flareon/FlareOn@2x.jpg');">
                        <img src='/images/flareon/FlareOn@2x.jpg' />
                        <div class="c-glitch__img" style="background-image: url('/images/flareon/FlareOn@2x.jpg');">
                        </div>
                        <div class="c-glitch__img" style="background-image: url('/images/flareon/FlareOn@2x.jpg');">
                        </div>
                        <div class="c-glitch__img" style="background-image: url('/images/flareon/FlareOn@2x.jpg');">
                        </div>
                        <div class="c-glitch__img" style="background-image: url('/images/flareon/FlareOn@2x.jpg');">
                        </div>
                        <div class="c-glitch__img" style="background-image: url('/images/flareon/FlareOn@2x.jpg');">
                        </div>
                    </div>
                </main>

                <h2 id="Phan-2"><a href="#Phan-2" class="headerlink" title="Ph·∫ßn 2">Ph·∫ßn 2</a></h2>
                <p>Ch√∫c m·ªçi ng∆∞·ªùi m·ªôt gi√°ng sinh vui v·∫ª üéÑ<br>C√πng ƒë·∫øn v·ªõi ph·∫ßn 2 c·ªßa series b√†i v·ªõi 5 th·ª≠ th√°ch:</p>
                <ul>
                    <li><code>report</code> (<a href="/static/flareon2020/solution4.zip">solution</a>)</li>
                    <li><code>TKApp</code> (<a href="/static/flareon2020/solution5.zip">solution</a>)</li>
                    <li><code>codeit</code> (<a href="/static/flareon2020/solution6.zip">solution</a>)</li>
                    <li><code>re_crowd</code> (<a href="/static/flareon2020/solution7.zip">solution</a>)</li>
                    <li><code>Aardvark</code> </li>
                </ul>
                <h1 id="4-report"><a href="#4-report" class="headerlink" title="4 - report">4 - report</a></h1>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">Nobody likes analysing infected documents, but it pays the bills. Reverse this macro thrill-ride to discover how to get it to show you the key.</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>·ªû challenge n√†y, ch√∫ng ta c√≥ 1 file excel:</p>
                <p><img src="/images/flareon/4/1.png"></p>
                <p>M·ªù file report.xls b·∫±ng Microsoft Excel:</p>
                <p><img src="/images/flareon/4/3.png"></p>
                <p>Khi l√†m vi·ªác v·ªõi c√°c file office, c√≥ 1 tool ƒë·ªÉ extract VBA macro t·ª´ ch√∫ng, ƒë√≥ l√† tool ‚Äúolevba‚Äù.</p>
                <blockquote>
                    <p>VBA macro: khi ph·∫£i l√†m c√°c c√¥ng vi·ªác th∆∞·ªùng xuy√™n l·∫∑p ƒëi l·∫∑p l·∫°i trong excel, b·∫°n c√≥ th·ªÉ vi·∫øt 1
                        script ƒë·ªÉ t·ª± ƒë·ªông c√°c c√¥ng vi·ªác ƒë√≥. Script ƒë√≥ ƒë∆∞·ª£c vei√©t b·∫±ng Visual Basic for Applications
                        (VBA).</p>
                    <p>L·ª£i d·ª•ng ƒëi·ªÅu n√†y, malware c≈©ng th∆∞·ªùng hay ch·ª©a c√°c VBA macro ƒë·ªôc h·∫°i trong c√°c file excel ƒë·ªÉ t·∫•n
                        c√¥ng ng∆∞·ªùi d√πng.</p>
                    <p>olevba l√† m·ªôt tool d√πng ƒë·ªÉ extract c√°c VBA macro trong file excel.</p>
                </blockquote>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">C:\Users\admin\Desktop\Mat\4_-_report&gt;olevba report.xls</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p><img src="/images/flareon/4/2.png"></p>
                <p>Sau khi ch·∫°y xong, ta ƒë√£ c√≥ ƒë∆∞·ª£c code VBA v√† s·∫µn s√†ng ph√¢n t√≠ch, nh∆∞ng ·ªü d∆∞·ªõi c√πng c√≥ 1 d√≤ng ƒë√°ng ƒë·ªÉ
                    √Ω:</p>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">VBA Stomping was detected: the VBA source code and P-code are different, this may have been used to hide malicious code</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>Tr∆∞·ªõc ti√™n ta c·∫ßn hi·ªÉu v·ªÅ VBA source code v√† P-code, ƒëo·∫°n gi·∫£i th√≠ch g·ªëc n·∫±m ·ªü <a target="_blank"
                        rel="noopener" href="https://github.com/bontchev/pcodedmp">ƒë√¢y</a></p>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">It is not widely known, but macros written in VBA (Visual Basic for Applications; the macro programming language used in Microsoft Office) exist in three different executable forms, each of which can be what is actually executed at run time, depending on the circumstances. These forms are:</span><br><span class="line"></span><br><span class="line">Source code. The original source code of the macro module is compressed and stored at the end of the module stream. This makes it relatively easy to locate and extract and most free DFIR tools for macro analysis like oledump or olevba or even many professional anti-virus tools look only at this form. However, most of the time the source code is completely ignored by Office. In fact, it is possible to remove the source code (and therefore make all these tools think that there are no macros present), yet the macros will still execute without any problems. I have created a proof of concept illustrating this. Most tools will not see any macros in the documents in this archive it but if opened with the corresponding Word version (that matches the document name), it will display a message and will launch calc.exe. It is surprising that malware authors are not using this trick more widely.</span><br><span class="line"></span><br><span class="line">P-code. As each VBA line is entered into the VBA editor, it is immediately compiled into p-code (a pseudo code for a stack machine) and stored in a different place in the module stream. The p-code is precisely what is executed most of the time. In fact, even when you open the source of a macro module in the VBA editor, what is displayed is not the decompressed source code but the p-code decompiled into source. Only if the document is opened under a version of Office that uses a different VBA version from the one that has been used to create the document, the stored compressed source code is re-compiled into p-code and then that p-code is executed. This makes it possible to open a VBA-containing document on any version of Office that supports VBA and have the macros inside remain executable, despite the fact that the different versions of VBA use different (incompatible) p-code instructions.</span><br><span class="line"></span><br><span class="line">... truncated</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>Nh∆∞ gi·∫£i th√≠ch ·ªü tr√™n th√¨:</p>
                <ul>
                    <li>VBA macro c√≥ th·ªÉ t·ªìn t·∫°i ·ªü 3 d·∫°ng kh√°c nhau.</li>
                    <li>D·∫°ng 1 l√† source code, source code s·∫Ω b·ªã n√©n l·∫°i v√† ƒë·∫∑t ·ªü cu·ªëi module. V√† ta c√≥ th·ªÉ b·ªè source
                        code kh·ªèi module m√† macro v·∫´n c√≥ th·ªÉ ch·∫°y b√¨nh th∆∞·ªùng.</li>
                    <li>D·∫°ng 2 l√† p-code: VBA macro s·∫Ω ƒë∆∞·ª£c bi√™n d·ªãch th√†nh p-code, l√† m·ªôt d·∫°ng m√£ gi·∫£ c·ªßa Microsoft.
                        Code n√†y m·ªõi l√† code ƒë∆∞·ª£c th·ª±c thi th·∫≠t s·ª±, v√† code n√†y c≈©ng ƒë∆∞·ª£c ƒë·∫∑t ·ªü trong module.</li>
                    <li>D·∫°ng 3 m√¨nh kh√¥ng ƒë·ªÅ c·∫≠p ·ªü ƒë√¢y.</li>
                </ul>
                <p>V·ªÅ VBA Stomping: <a target="_blank" rel="noopener"
                        href="https://medium.com/walmartglobaltech/vba-stomping-advanced-maldoc-techniques-612c484ab278">c√≥
                        th·ªÉ ƒë·ªçc th√™m ·ªü ƒë√¢y</a>, nh∆∞ng c∆° b·∫£n ta c√≥ th·ªÉ hi·ªÉu l√†:</p>
                <ul>
                    <li>Khi l∆∞u 1 file excel, n√≥ s·∫Ω ch·ª©a c·∫£ source code v√† p-code trong ƒë√≥.</li>
                    <li>Nh∆∞ng source code v√† p-code n√†y kh√¥ng match nhau, t·ª©c l√† p-code ho·∫∑c source code ƒë√£ b·ªã thay ƒë·ªïi.
                    </li>
                </ul>
                <p>ƒê·ªÉ kh√¥i ph·ª•c VBA code t·ª´ P-code, ta c√≥ th·ªÉ d√πng <a target="_blank" rel="noopener"
                        href="https://pypi.org/project/pcode2code/">pcode2code</a> (ho·∫∑c ƒë·ªçc p-code lu√¥n).</p>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">C:\Users\admin\Desktop\Mat\4_-_report&gt;pcode2code report.xls</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>So s√°nh code m·ªõi v√† code c≈© (code m·ªõi ·ªü b√™n tr√°i)</p>
                <p><img src="/images/flareon/4/4.png"></p>
                <p>H√†m <code>rigmarole</code> d√πng ƒë·ªÉ decrypt string:</p>
                <figure class="highlight vbscript">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="keyword">Function</span> rigmarole(es As <span class="built_in">String</span>, id_FFFE As <span class="built_in">String</span>) As <span class="built_in">String</span></span><br><span class="line">    <span class="keyword">Dim</span> furphy As <span class="built_in">String</span></span><br><span class="line">    <span class="keyword">Dim</span> c As Integer</span><br><span class="line">    <span class="keyword">Dim</span> s As <span class="built_in">String</span></span><br><span class="line">    <span class="keyword">Dim</span> cc As Integer</span><br><span class="line">    furphy = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">For</span> i = <span class="number">1</span> <span class="keyword">To</span> <span class="built_in">Len</span>(es) <span class="keyword">Step</span> <span class="number">4</span></span><br><span class="line">        c = CDec(<span class="string">&quot;&amp;H&quot;</span> &amp; <span class="built_in">Mid</span>(es, i, <span class="number">2</span>))</span><br><span class="line">        s = CDec(<span class="string">&quot;&amp;H&quot;</span> &amp; <span class="built_in">Mid</span>(es, i + <span class="number">2</span>, <span class="number">2</span>))</span><br><span class="line">        cc = c - s</span><br><span class="line">        furphy = furphy + <span class="built_in">Chr</span>(cc)</span><br><span class="line">    <span class="keyword">Next</span> i</span><br><span class="line">    rigmarole = furphy</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>List string decrypt ƒë∆∞·ª£c l√†:</p>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">AppData</span><br><span class="line">\Microsoft\stomp.mp3</span><br><span class="line">play </span><br><span class="line">FLARE-ON</span><br><span class="line">Sorry, this machine is not supported.</span><br><span class="line">FLARE-ON</span><br><span class="line">Error</span><br><span class="line">winmgmts:\\.\root\CIMV2</span><br><span class="line">SELECT Name FROM Win32_Process</span><br><span class="line">vbox</span><br><span class="line">WScript.Network</span><br><span class="line">\Microsoft\v.png</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>M√¨nh t·∫°o 1 file excel m·ªõi, th√™m VBA macro m·ªõi v√†o, copy c√°c Form y chang t·ª´ file excel c≈© ƒë·ªÉ debug,
                    ta s·∫Ω ph√¢n t√≠ch h√†m <code>folderol</code>.</p>
                <figure class="highlight vbscript">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="keyword">If</span> GetInternetConnectedState() = <span class="literal">False</span> <span class="keyword">Then</span></span><br><span class="line">    <span class="built_in">MsgBox</span> <span class="string">&quot;Cannot establish Internet connection.&quot;</span>, vbCritical, <span class="string">&quot;Error&quot;</span></span><br><span class="line">    <span class="keyword">End</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Set</span> fudgel = <span class="built_in">GetObject</span>(rigmarole(onzo(<span class="number">7</span>)))</span><br><span class="line"><span class="keyword">Set</span> twattling = fudgel.ExecQuery(rigmarole(onzo(<span class="number">8</span>)), , <span class="number">48</span>)</span><br><span class="line"><span class="keyword">For</span> <span class="keyword">Each</span> p <span class="keyword">In</span> twattling</span><br><span class="line">    <span class="keyword">Dim</span> pos As Integer</span><br><span class="line">    pos = <span class="built_in">InStr</span>(<span class="built_in">LCase</span>(p.Name), <span class="string">&quot;vmw&quot;</span>) + <span class="built_in">InStr</span>(<span class="built_in">LCase</span>(p.Name), <span class="string">&quot;vmt&quot;</span>) + <span class="built_in">InStr</span>(<span class="built_in">LCase</span>(p.Name), rigmarole(onzo(<span class="number">9</span>)))</span><br><span class="line">    <span class="keyword">If</span> pos &gt; <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">        <span class="built_in">MsgBox</span> rigmarole(onzo(<span class="number">4</span>)), vbCritical, rigmarole(onzo(<span class="number">6</span>))</span><br><span class="line">        <span class="keyword">End</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">Next</span></span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>ƒêo·∫°n code tr√™n ki·ªÉm tra xem m√°y c√≥ ƒë∆∞·ª£c k·∫øt n·ªëi internet hay kh√¥ng, ngo√†i ra c√≤n ki·ªÉm tra trong list
                    process xem c√≥ process n√†o c√≥ ch·ª©a ‚Äúvmw‚Äù, ‚Äúvmt‚Äù, ‚Äúvbox‚Äù trong t√™n kh√¥ng, ƒë√¢y ch√≠nh l√† c∆° ch·∫ø anti-vm
                    c·ªßa n√≥. (v√≠ d·ª•, ‚Äúvmware‚Äù c√≥ ch·ª©a ‚Äúvmw‚Äù, c√≤n c·ª•m ‚Äúvbox‚Äù c√≥ th·ªÉ ƒë∆∞·ª£c t√¨m th·∫•y n·∫øu b·∫°n d√πng
                    virtualbox).</p>
                <figure class="highlight vbscript">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">xertz = <span class="built_in">Array</span>(&amp;H11, &amp;H22, &amp;H33, &amp;H44, &amp;H55, &amp;H66, &amp;H77, &amp;H88, &amp;H99, &amp;HAA, &amp;HBB, &amp;HCC, &amp;HDD, &amp;HEE)</span><br><span class="line"><span class="keyword">Set</span> groke = <span class="built_in">CreateObject</span>(rigmarole(onzo(<span class="number">10</span>)))</span><br><span class="line">firkin = groke.UserDomain</span><br><span class="line"><span class="keyword">If</span> firkin &lt;&gt; rigmarole(onzo(<span class="number">3</span>)) <span class="keyword">Then</span></span><br><span class="line">    <span class="built_in">MsgBox</span> rigmarole(onzo(<span class="number">4</span>)), vbCritical, rigmarole(onzo(<span class="number">6</span>))</span><br><span class="line"><span class="keyword">End</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>ƒêo·∫°n tr√™n ki·ªÉm tra user domain c√≥ ph·∫£i l√† ‚ÄúFLARE-ON‚Äù hay kh√¥ng, sau khi v∆∞·ª£t qua c√°c ƒëo·∫°n check,
                    program s·∫Ω decrypt 1 ƒëo·∫°n nh·ªã ph√¢n v√† l∆∞u ·ªü ‚Äú%appdata%\Microsoft\v.png‚Äù</p>
                <p><img src="/images/flareon/4/v.png"></p>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">thi5_cou1d_h4v3_b33n_b4d@flare-on.com</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>


                <h1 id="5-TKApp"><a href="#5-TKApp" class="headerlink" title="5 - TKApp">5 - TKApp</a></h1>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">Now you can play Flare-On on your watch! As long as you still have an arm left to put a watch on, or emulate the watch&#39;s operating system with sophisticated developer tools.</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p><img src="/images/flareon/5/1.png"></p>
                <p>ƒê·ªÅ b√†i cho 1 file .tpk, sau 1 l√∫c google, m√¨nh ph√°t hi·ªán ƒë√¢y l√† file ch·∫°y tr√™n h·ªá ƒëi·ªÅu h√†nh <a
                        target="_blank" rel="noopener" href="https://www.tizen.org/">Tizen</a>. T·∫£i gi·∫£ l·∫≠p Tizen Studio
                    v·ªÅ, ch·∫°y th·ª≠ file, th√¨ ƒë√¢y tr√¥ng gi·ªëng 1 app tr√™n ƒë·ªìng h·ªì th√¥ng minh, c√≥ c√°c ch·ª©c nƒÉng ƒë·ªãnh v·ªã, ƒëo
                    nh·ªãp tim, v.v‚Ä¶</p>
                <blockquote>
                    <p>B√†i n√†y kh√¥ng c·∫ßn ch·∫°y file, ch·ªâ c·∫ßn ph√¢n t√≠ch tƒ©nh c≈©ng c√≥ th·ªÉ gi·∫£i ƒë∆∞·ª£c.</p>
                </blockquote>
                <p>Hai byte ƒë·∫ßu c·ªßa file .tpk l√† <code>PK</code>, n√™n m√¨nh ƒë·ªïi ƒë·ªãnh d·∫°ng file th√†nh ‚Äú.zip‚Äù r·ªìi gi·∫£i n√©n.
                </p>
                <p><img src="/images/flareon/5/2.png"></p>
                <p><img src="/images/flareon/5/3.png"></p>
                <p>D√πng ‚ÄúDetect it easy‚Äù:</p>
                <p><img src="/images/flareon/5/4.png"></p>
                <p>File ƒë∆∞·ª£c nh·∫≠n di·ªán l√† .net, d√πng ‚Äúdnspy‚Äù ƒë·ªÉ m·ªü l√™n v√† ph√¢n t√≠ch.</p>
                <blockquote>
                    <p>dnspy l√† m·ªôt tool d√πng ƒë·ªÉ ph√¢n t√≠ch c√°c file .net.</p>
                </blockquote>
                <figure class="highlight c#">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">PedDataUpdate</span>(<span class="params"><span class="built_in">object</span> sender, PedometerDataUpdatedEventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (e.StepCount &gt; <span class="number">50U</span> &amp;&amp; <span class="built_in">string</span>.IsNullOrEmpty(App.Step))</span><br><span class="line">    &#123;</span><br><span class="line">        App.Step = Application.Current.ApplicationInfo.Metadata[<span class="string">&quot;its&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(App.Password) &amp;&amp; !<span class="built_in">string</span>.IsNullOrEmpty(App.Note) &amp;&amp; !<span class="built_in">string</span>.IsNullOrEmpty(App.Step) &amp;&amp; !<span class="built_in">string</span>.IsNullOrEmpty(App.Desc))</span><br><span class="line">    &#123;</span><br><span class="line">        HashAlgorithm hashAlgorithm = SHA256.Create();</span><br><span class="line">        <span class="built_in">byte</span>[] bytes = Encoding.ASCII.GetBytes(App.Password + App.Note + App.Step + App.Desc);</span><br><span class="line">        <span class="built_in">byte</span>[] first = hashAlgorithm.ComputeHash(bytes);</span><br><span class="line">        <span class="built_in">byte</span>[] second = <span class="keyword">new</span> <span class="built_in">byte</span>[] &#123; <span class="comment">/* a lot of bytes here */</span>   &#125;;</span><br><span class="line">        <span class="keyword">if</span> (first.SequenceEqual(second))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.btn.Source = <span class="string">&quot;img/tiger2.png&quot;</span>;</span><br><span class="line">            <span class="keyword">this</span>.btn.Clicked += <span class="keyword">this</span>.Clicked;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.btn.Source = <span class="string">&quot;img/tiger1.png&quot;</span>;</span><br><span class="line">        <span class="keyword">this</span>.btn.Clicked -= <span class="keyword">this</span>.Clicked;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <figure class="highlight c#">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">GetImage</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(App.Password) || <span class="built_in">string</span>.IsNullOrEmpty(App.Note) || <span class="built_in">string</span>.IsNullOrEmpty(App.Step) || <span class="built_in">string</span>.IsNullOrEmpty(App.Desc))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.btn.Source = <span class="string">&quot;img/tiger1.png&quot;</span>;</span><br><span class="line">        <span class="keyword">this</span>.btn.Clicked -= <span class="keyword">this</span>.Clicked;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">string</span> text = <span class="keyword">new</span> <span class="built_in">string</span>(<span class="keyword">new</span> <span class="built_in">char</span>[]</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// a lot of chars here, take from App.Password/Note/Step/Desc</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">byte</span>[] key = SHA256.Create().ComputeHash(Encoding.ASCII.GetBytes(text));</span><br><span class="line">    <span class="built_in">byte</span>[] bytes = Encoding.ASCII.GetBytes(<span class="string">&quot;NoSaltOfTheEarth&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        App.ImgData = Convert.FromBase64String(Util.GetString(Runtime.Runtime_dll, key, bytes));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Exception ex)</span><br><span class="line">    &#123;</span><br><span class="line">        Toast.DisplayText(<span class="string">&quot;Failed: &quot;</span> + ex.Message, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>V·ªÅ c∆° b·∫£n, ch∆∞∆°ng tr√¨nh l·∫•y 4 string <code>App.Password, App.Note, App.Step, App.Desc</code> n·ªëi l·∫°i
                    v·ªõi nhau, t√≠nh SHA256 r·ªìi l·∫•y hash ƒë√≥ ƒë·ªÉ gi·∫£i m√£ file ‚ÄúRuntime.dll‚Äù v·ªõi thu·∫≠t to√°n AES256.</p>
                <p>ƒê·ªÉ t√¨m xem <code>App.Password</code> ƒë∆∞·ª£c d√πng ·ªü ch·ªó n√†o, ta chu·ªôt ph·∫£i v√†o <code>App.Password</code>
                    trong h√†m <code>PedDataUpdate</code>, ch·ªçn ‚ÄúAnalyze‚Äù:</p>
                <p><img src="/images/flareon/5/7.png"></p>
                <p>Sau ƒë√≥ ta c√≥ th·ªÉ th·∫•y n√≥ ƒë∆∞·ª£c ‚Äúset‚Äù (t·ª©c l√† ƒë∆∞·ª£c g√°n) ·ªü h√†m <code>OnLoginButtonClicked</code>:</p>
                <p><img src="/images/flareon/5/8.png"></p>
                <p>Ta ƒë·∫øn h√†m n√†y xem code:</p>
                <figure class="highlight c#">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">OnLoginButtonClicked</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.IsPasswordCorrect(<span class="keyword">this</span>.passwordEntry.Text))</span><br><span class="line">    &#123;</span><br><span class="line">        App.IsLoggedIn = <span class="literal">true</span>;</span><br><span class="line">        App.Password = <span class="keyword">this</span>.passwordEntry.Text;</span><br><span class="line">        <span class="keyword">base</span>.Navigation.InsertPageBefore(<span class="keyword">new</span> MainPage(), <span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">await</span> <span class="keyword">base</span>.Navigation.PopAsync();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        Toast.DisplayText(<span class="string">&quot;Unlock failed!&quot;</span>, <span class="number">2000</span>);</span><br><span class="line">        <span class="keyword">this</span>.passwordEntry.Text = <span class="built_in">string</span>.Empty;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>H√†m n√†y l·∫°i d√πng h√†m <code>IsPasswordCorrect</code>, ta t·ªõi h√†m n√†y xem:</p>
                <figure class="highlight c#">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">byte</span>[] Password = <span class="keyword">new</span> <span class="built_in">byte</span>[] &#123;<span class="number">62</span>, <span class="number">38</span>, <span class="number">63</span>, <span class="number">63</span>, <span class="number">54</span>, <span class="number">39</span>, <span class="number">59</span>, <span class="number">50</span>, <span class="number">39</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">IsPasswordCorrect</span>(<span class="params"><span class="built_in">string</span> password</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> password == Util.Decode(TKData.Password);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">Decode</span>(<span class="params"><span class="built_in">byte</span>[] e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> text = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="built_in">byte</span> b <span class="keyword">in</span> e)</span><br><span class="line">    &#123;</span><br><span class="line">        text += Convert.ToChar((<span class="built_in">int</span>)(b ^ <span class="number">83</span>)).ToString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> text;</span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>V·ªõi <code>App.Password</code>, ta t√≠nh ra ƒë∆∞·ª£c chu·ªói ‚Äúmullethat‚Äù. Ta ti·∫øp t·ª•c l√†m t∆∞∆°ng t·ª± (chu·ªôt
                    ph·∫£i -&gt; analyze v·ªõi <code>App.Note, App.Step, App.Desc</code>).</p>
                <figure class="highlight c#">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SetupList</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    List&lt;TodoPage.Todo&gt; list = <span class="keyword">new</span> List&lt;TodoPage.Todo&gt;();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.isHome)</span><br><span class="line">    &#123;</span><br><span class="line">        list.Add(<span class="keyword">new</span> TodoPage.Todo(<span class="string">&quot;go home&quot;</span>, <span class="string">&quot;and enable GPS&quot;</span>, <span class="literal">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        TodoPage.Todo[] collection = <span class="keyword">new</span> TodoPage.Todo[]</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> TodoPage.Todo(<span class="string">&quot;hang out in tiger cage&quot;</span>, <span class="string">&quot;and survive&quot;</span>, <span class="literal">true</span>),</span><br><span class="line">            <span class="keyword">new</span> TodoPage.Todo(<span class="string">&quot;unload Walmart truck&quot;</span>, <span class="string">&quot;keep steaks for dinner&quot;</span>, <span class="literal">false</span>),</span><br><span class="line">            <span class="keyword">new</span> TodoPage.Todo(<span class="string">&quot;yell at staff&quot;</span>, <span class="string">&quot;maybe fire someone&quot;</span>, <span class="literal">false</span>),</span><br><span class="line">            <span class="keyword">new</span> TodoPage.Todo(<span class="string">&quot;say no to drugs&quot;</span>, <span class="string">&quot;unless it&#x27;s a drinking day&quot;</span>, <span class="literal">false</span>),</span><br><span class="line">            <span class="keyword">new</span> TodoPage.Todo(<span class="string">&quot;listen to some tunes&quot;</span>, <span class="string">&quot;https://youtu.be/kTmZnQOfAF8&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        list.AddRange(collection);</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;TodoPage.Todo&gt; list2 = <span class="keyword">new</span> List&lt;TodoPage.Todo&gt;();</span><br><span class="line">    <span class="keyword">foreach</span> (TodoPage.Todo todo <span class="keyword">in</span> list)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!todo.Done)</span><br><span class="line">        &#123;</span><br><span class="line">            list2.Add(todo);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.mylist.ItemsSource = list2;</span><br><span class="line">    App.Note = list2[<span class="number">0</span>].Note;</span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>V·ªõi <code>App.Note</code>, ta c√≥ th·ªÉ th·∫•y ƒë∆∞·ª£c n√≥ l√† chu·ªói ‚Äúkeep steaks for dinner‚Äù.</p>
                <figure class="highlight c#">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">PedDataUpdate</span>(<span class="params"><span class="built_in">object</span> sender, PedometerDataUpdatedEventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (e.StepCount &gt; <span class="number">50U</span> &amp;&amp; <span class="built_in">string</span>.IsNullOrEmpty(App.Step))</span><br><span class="line">    &#123;</span><br><span class="line">        App.Step = Application.Current.ApplicationInfo.Metadata[<span class="string">&quot;its&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// truncated ...</span></span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p><img src="/images/flareon/5/5.png"></p>
                <p>V·ªõi <code>App.Step</code>, n√≥ ch√≠nh l√† chu·ªói ‚Äúmagic‚Äù.</p>
                <figure class="highlight c#">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">IndexPage_CurrentPageChanged</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">base</span>.Children.IndexOf(<span class="keyword">base</span>.CurrentPage) == <span class="number">4</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (ExifReader exifReader = <span class="keyword">new</span> ExifReader(Path.Combine(Application.Current.DirectoryInfo.Resource, <span class="string">&quot;gallery&quot;</span>, <span class="string">&quot;05.jpg&quot;</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> desc;</span><br><span class="line">            <span class="keyword">if</span> (exifReader.GetTagValue&lt;<span class="built_in">string</span>&gt;(ExifTags.ImageDescription, <span class="keyword">out</span> desc))</span><br><span class="line">            &#123;</span><br><span class="line">                App.Desc = desc;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    App.Desc = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>V·ªõi <code>App.Desc</code>, ta c√≥ th·ªÉ c√†i ƒë·∫∑t th∆∞ vi·ªán <a target="_blank" rel="noopener"
                        href="https://www.nuget.org/packages/ExifLib/">ExifLib</a>, vi·∫øt l·∫°i m·ªôt ƒëo·∫°n code nh∆∞ tr√™n v√†
                    l·∫•y ƒë∆∞·ª£c chu·ªói ‚Äúwater‚Äù, c√≤n file ·∫£nh ‚Äú05.jpg‚Äù c√≥ th·ªÉ l·∫•y t·ª´ c√°c file c√≥ ƒë∆∞·ª£c sau khi gi·∫£i n√©n
                    TKApp.tpk.</p>
                <p>T·∫•t c·∫£ m·ªçi th·ª© ƒë√£ c√≥, ta vi·∫øt ƒëo·∫°n script ƒë·ªÉ decrypt file:</p>
                <figure class="highlight python">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sha256</span>(<span class="params">text: <span class="built_in">str</span></span>) -&gt; tuple:</span></span><br><span class="line">    h = hashlib.sha256()</span><br><span class="line">    h.update(text.encode())</span><br><span class="line">    <span class="keyword">return</span> h.hexdigest(), h.digest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aes_dec</span>(<span class="params">data: <span class="built_in">bytes</span>, key: <span class="built_in">bytes</span>, iv: <span class="built_in">bytes</span></span>) -&gt; bytes:</span></span><br><span class="line">    key_size = <span class="number">32</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(key) == key_size <span class="keyword">and</span> <span class="built_in">len</span>(iv) == <span class="number">16</span></span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv=iv)</span><br><span class="line">    s = cipher.decrypt(data)</span><br><span class="line">    <span class="keyword">return</span> s[:-<span class="built_in">ord</span>(s[<span class="built_in">len</span>(s)<span class="number">-1</span>:])]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    Password = <span class="string">&quot;mullethat&quot;</span></span><br><span class="line">    Note =<span class="string">&quot;keep steaks for dinner&quot;</span></span><br><span class="line">    Step = <span class="string">&quot;magic&quot;</span></span><br><span class="line">    Desc = <span class="string">&quot;water&quot;</span></span><br><span class="line">    </span><br><span class="line">    final = Password + Note + Step + Desc</span><br><span class="line">    </span><br><span class="line">    text = [Desc[<span class="number">2</span>], Password[<span class="number">6</span>], Password[<span class="number">4</span>], Note[<span class="number">4</span>], Note[<span class="number">0</span>], Note[<span class="number">17</span>], Note[<span class="number">18</span>], Note[<span class="number">16</span>],</span><br><span class="line">            Note[<span class="number">11</span>], Note[<span class="number">13</span>], Note[<span class="number">12</span>], Note[<span class="number">15</span>], Step[<span class="number">4</span>], Password[<span class="number">6</span>], Desc[<span class="number">1</span>], Password[<span class="number">2</span>],</span><br><span class="line">            Password[<span class="number">2</span>], Password[<span class="number">4</span>], Note[<span class="number">18</span>], Step[<span class="number">2</span>], Password[<span class="number">4</span>], Note[<span class="number">5</span>], Note[<span class="number">4</span>], Desc[<span class="number">0</span>],</span><br><span class="line">            Desc[<span class="number">3</span>], Note[<span class="number">15</span>], Note[<span class="number">8</span>], Desc[<span class="number">4</span>], Desc[<span class="number">3</span>], Note[<span class="number">4</span>], Step[<span class="number">2</span>], Note[<span class="number">13</span>], Note[<span class="number">18</span>],</span><br><span class="line">            Note[<span class="number">18</span>], Note[<span class="number">8</span>], Note[<span class="number">4</span>], Password[<span class="number">0</span>], Password[<span class="number">7</span>], Note[<span class="number">0</span>], Password[<span class="number">4</span>], Note[<span class="number">11</span>],</span><br><span class="line">            Password[<span class="number">6</span>], Password[<span class="number">4</span>], Desc[<span class="number">4</span>], Desc[<span class="number">3</span>]</span><br><span class="line">    ]</span><br><span class="line">    text = <span class="string">&#x27;&#x27;</span>.join(text)</span><br><span class="line">    data = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;Runtime.dll&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    dec = aes_dec(data, sha256(text)[<span class="number">1</span>], <span class="string">b&#x27;NoSaltOfTheEarth&#x27;</span>)</span><br><span class="line">    dec = b64decode(dec)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;out.bin&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(dec)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;[+] Done&#x27;</span>)</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>Sau khi ch·∫°y xong ƒëo·∫°n code tr√™n ta ƒë∆∞·ª£c 1 file m·ªõi, c√≥ ch·ª©a JFIF trong ph·∫ßn header.</p>
                <p><img src="/images/flareon/5/6.png"></p>
                <p>ƒê·ªïi t√™n file m·ªõi th√†nh ‚Äúout.jpg‚Äù, ta ƒë∆∞·ª£c ·∫£nh sau:</p>
                <p><img src="/images/flareon/5/out.jpg"></p>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">n3ver_go1ng_to_recov3r@flare-on.com</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>



                <h1 id="6-codeit"><a href="#6-codeit" class="headerlink" title="6 - codeit">6 - codeit</a></h1>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">Reverse engineer this little compiled script to figure out what you need to do to make it give you the flag (as a QR code).</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p><img src="/images/flareon/6/1.png"></p>
                <p>·ªû b√†i n√†y, ch√∫ng ta c√≥ 1 file .exe</p>
                <p><img src="/images/flareon/6/2.png"></p>
                <p>‚ÄúDetect it easy‚Äù ƒë√£ nh·∫≠n ra ƒë√¢y l√† file th·ª±c thi ƒë∆∞·ª£c vi·∫øt b·∫±ng AutoIt. Ch·∫°y file th·ª≠:</p>
                <p><img src="/images/flareon/6/3.png"></p>
                <p>D√πng ‚ÄúExe2Aut‚Äù ƒë·ªÉ convert file n√†y v·ªÅ d·∫°ng code AutoIt, ta ƒë∆∞·ª£c:</p>
                <p><img src="/images/flareon/6/4.png"></p>
                <blockquote>
                    <p>Exe2Aut l√† m·ªôt tool d√πng ƒë·ªÉ convert binary ƒë∆∞·ª£c vi·∫øt b·∫±ng AutoIT v·ªÅ d·∫°ng source code c·ªßa n√≥.</p>
                </blockquote>
                <p>C√≥ v·∫ª nh∆∞ file n√†y ƒë√£ b·ªã <code>obfuscated</code> ƒë·ªÉ l√†m kh√≥ vi·ªác RE. ƒê·∫øn ƒë√¢y c√≥ 2 l·ª±a ch·ªçn, ta c√≥ th·ªÉ
                    d√πng ch·ª©c nƒÉng ‚ÄúFind and replace‚Äù c·ªßa editor ƒë·ªÉ s·ª≠a l·∫°i ƒë·ªëng n√†y, ho·∫∑c vi·∫øt 1 ƒëo·∫°n regex ƒë·ªÉ rename
                    l·∫°i to√†n b·ªô ch√∫ng. ·ªû ƒë√¢y m√¨nh ch·ªçn c√°ch vi·∫øt regex b·∫±ng python, l√Ω do l√† v√¨:</p>
                <ul>
                    <li>M√¨nh th·∫•y t√™n bi·∫øn sau khi source code b·ªã obfuscate c√≥ quy lu·∫≠t, n√™n c√≥ th·ªÉ d√πng regex.</li>
                    <li>Gi·∫£ s·ª≠ c√≥ hai h√†m, g·ªçi l√† h√†m A v√† h√†m B cho d·ªÖ, hai h√†m n√†y ƒë·ªÅu c√≥ bi·∫øn local t√™n l√† ‚Äúx‚Äù ch·∫≥ng
                        h·∫°n. D√πng ‚ÄúFind and Replace‚Äù ƒë·ªÉ ƒë·ªïi t√™n bi·∫øn ‚Äúx‚Äù, th√¨ ta s·∫Ω thay ƒë·ªïi bi·∫øn ‚Äúx‚Äù ·ªü c·∫£ hai h√†m, c√≤n
                        d√πng regex th√¨ c√≥ th·ªÉ thay ƒë·ªïi ‚Äúx‚Äù c·ªßa ch·ªâ m·ªôt h√†m (ho·∫∑c c·∫£ hai h√†m lu√¥n c≈©ng ƒë∆∞·ª£c).</li>
                </ul>
                <p>√ù t∆∞·ªüng vi·∫øt regex nh∆∞ sau:</p>
                <p>V√≠ d·ª•, trong ƒëo·∫°n code c√≥ m·ªôt s·ªë ch·ªó nh∆∞ sau:</p>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">Global $flavekolca &#x3D; Number(&quot; 0 &quot;)</span><br><span class="line">Global $flwecmddtc &#x3D; Number(&quot; 1 &quot;)</span><br><span class="line">...</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>M√¨nh th·∫•y t√™n bi·∫øn (b√™n tr√°i d·∫•u b·∫±ng) l√∫c n√†o c≈©ng g·ªìm 10 k√Ω t·ª± (<code>flavekolca</code>,
                    <code>flwecmddtc</code>, ‚Ä¶), h∆°n n·ªØa t√™n bi·∫øn lu√¥n b·∫Øt ƒë·∫ßu b·∫±ng chu·ªói <code>fl</code>. C√≤n v·∫ø ph·∫£i
                    d·∫•u b·∫±ng th√¨ lu√¥n l√† <code>Number(&quot;</code>, ti·∫øp ƒë·∫øn l√† m·ªôt d·∫•u c√°ch, r·ªìi ƒë·∫øn m·ªôt h·∫±ng s·ªë, r·ªìi
                    theo sau ƒë√≥ l√† m·ªôt d·∫•u c√°ch v√† <code>&quot;)</code>. Nh·∫≠n ra ƒë∆∞·ª£c quy lu·∫≠t tr√™n, m√¨nh c√≥ th·ªÉ d√πng
                    ƒëo·∫°n regex sau ƒë·ªÉ match c√°c ƒëo·∫°n string nh∆∞ tr√™n:
                </p>
                <figure class="highlight python">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">template = <span class="string">rb&#x27;(?P&lt;name&gt;\$fl[a-z]&#123;8&#125;) = Number\(&quot; (?P&lt;num&gt;[0-9]+) &quot;\)&#x27;</span></span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p><img src="/images/flareon/6/11.png"></p>
                <p>Sau ƒë√≥ m√¨nh ch·ªâ vi·ªác replace l·∫°i th√†nh c√°i g√¨ ƒë√≥ ƒë∆°n gi·∫£n h∆°n l√† xong, v√≠ d·ª• m√¨nh s·∫Ω d√πng python ƒë·ªÉ
                    s·ª≠a ƒëo·∫°n tr√™n th√†nh:</p>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">Global $global_0_0 &#x3D; 0</span><br><span class="line">...</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>·ªû tr√™n ch·ªâ l√† √Ω t∆∞·ªüng, c√≤n code m√¨nh s·∫Ω ƒë·ªÉ ·ªü file ƒë√≠nh k√®m. Sau khi ch·∫°y code xong, ta ƒë∆∞·ª£c file
                    source code AutoIt m·ªõi, d·ªÖ ƒë·ªçc h∆°n nhi·ªÅu.</p>
                <p><img src="/images/flareon/6/5.png"></p>
                <p>ƒêo·∫°n code m·ªõi kh√¥ng qu√° d√†i, ta c√≥ th·ªÉ ƒë·ªçc v√† hi·ªÉu c√°c function c·ªßa n√≥. V·ªÅ c∆° b·∫£n, ch∆∞∆°ng tr√¨nh nh·∫≠n
                    input t·ª´ ng∆∞·ªùi d√πng, sau ƒë√≥ t·∫°o ra m√£ QR d∆∞·ªõi d·∫°ng h√¨nh ·∫£nh r·ªìi hi·ªán l√™n m√†n h√¨nh.</p>
                <p><img src="/images/flareon/6/6.png"></p>
                <p>·ªû <code>func_08</code>, ch∆∞∆°ng tr√¨nh nh·∫≠n v√†o input c·ªßa ng∆∞·ªùi d√πng ƒë·ªÉ x·ª≠ l√Ω, sau ƒë√≥ ƒë∆∞a data ƒë√£ ƒë∆∞·ª£c
                    x·ª≠ l√Ω v√†o <code>func_05</code>.</p>
                <p><img src="/images/flareon/6/7.png"></p>
                <p>·ªû <code>func_05</code>, ch∆∞∆°ng tr√¨nh l·∫•y <code>computer_name</code> (·ªü ch·ªó s·ªë 6), sau ƒë√≥ encrypt n√≥ ·ªü
                    h√†m <code>func_04</code> (s·ªë 7). Ti·∫øp theo, ƒëo·∫°n <code>computer_name</code> ƒë∆∞·ª£c m√£ h√≥a s·∫Ω ƒë∆∞·ª£c t√≠nh
                    hash ƒë·ªÉ l√†m key cho b∆∞·ªõc <code>CryptDecrypt</code> ·ªü d∆∞·ªõi (s·ªë 5).</p>
                <ul>
                    <li>Hash ƒë∆∞·ª£c d√πng trong b√†i n√†y l√† <code>32780 (CALG_SHA_256)</code> (s·ªë 2) , v√† thu·∫≠t to√°n m√£ h√≥a
                        ƒë∆∞·ª£c d√πng l√† <code>24 (AES)</code> (s·ªë 1).</li>
                    <li>·ªû h√¨nh tr√™n, ƒëo·∫°n code c√≥ ƒë√°nh s·ªë 3 ch√≠nh l√† kh·ªüi t·∫°o <code>$local_5</code> ƒë·ªÉ l∆∞u tr·ªØ data b·ªã
                        m√£ ho√°, c√≤n ƒëo·∫°n code ƒë√°nh s·ªë 4 l√† g√°n <code>$local_5</code> v√†o struct ƒë·ªÉ chu·∫©n b·ªã decrypt.
                    </li>
                    <li>ƒêi·ªÅu ki·ªán ƒë·ªÉ c√≥ th·ªÉ ƒëi v√†o trong nh√°nh <code>If</code> cu·ªëi c√πng (s·ªë 8 ·ªü trong h√¨nh tr√™n) ƒë√≥
                        ch√≠nh l√†, sau khi decrypt data ch·ª©a ·ªü <code>$local_5</code>, th√¨ 5 byte ƒë·∫ßu ph·∫£i l√†
                        <code>&quot;FLARE&quot;</code> v√† 5 byte cu·ªëi c√πng l√† <code>&quot;ERALF&quot;</code>.
                    </li>
                </ul>
                <p>V√† cu·ªëi c√πng, ta ph·∫£i xem l·∫°i h√†m <code>func_04</code>, v√¨ n√≥ bi·∫øn ƒë·ªïi <code>computer_name</code>
                    tr∆∞·ªõc khi t√≠nh hash.</p>
                <p><img src="/images/flareon/6/8.png"></p>
                <p>ƒêo·∫°n code tr√™n bi·∫øn ƒë·ªïi <code>$arg_0</code> d·ª±a v√†o n·ªôi dung c·ªßa file .bmp (file n√†y ƒë∆∞·ª£c drop ra
                    trong l√∫c ch∆∞∆°ng tr√¨nh x·ª≠ l√Ω ·∫£nh QR).</p>
                <p><strong>T√≥m l·∫°i t·ªõi l√∫c n√†y ta bi·∫øt ƒë∆∞·ª£c r·∫±ng input t·ª´ ng∆∞·ªùi d√πng kh√¥ng c√≥ t√°c d·ª•ng g√¨ ƒë·ªëi v·ªõi vi·ªác
                        l·∫•y flag, quan tr·ªçng l√† <code>computer_name</code> ph·∫£i tho·∫£ m√£n nh·ªØng ƒëi·ªÅu sau:</strong></p>
                <ul>
                    <li><code>key = sha256(func_04(computer_name))</code></li>
                    <li><code>data = AES.decrypt(encrypted_data, key, IV = 0000000...)</code></li>
                    <li><code>data.startswith(b&#39;FLARE&#39;) == True</code></li>
                    <li><code>data.endswith(b&#39;ERALF&#39;) == True</code></li>
                </ul>
                <p>Tuy nhi√™n ch√∫ng ta kh√¥ng th·ªÉ bi·∫øt ƒë∆∞·ª£c <code>computer_name</code> l√† g√¨, c≈©ng kh√¥ng th·ªÉ bruteforce
                    d·ª±a tr√™n 2 ƒëi·ªÅu ki·ªán ‚ÄúFLARE‚Äù v√† ‚ÄúERALF‚Äù v√¨ AES kh√¥ng b·ªã ‚ÄúKnown plain-text attack‚Äù.</p>
                <p>V√¨ kh√¥ng c√≥ ƒëi·ªÅu ki·ªán n√†o ƒë·ªÉ gi·∫£i ra <code>computer_name</code> n√™n m√¨nh ƒëo√°n r·∫±ng:</p>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">func_04(computer_name) &#x3D;&#x3D; computer_name</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>T·ª©c l√†, <code>computer_name</code> s·∫Ω l√† m·ªôt chu·ªói ƒë·∫∑c bi·ªát m√† s·∫Ω kh√¥ng b·ªã bi·∫øn ƒë·ªïi khi qua h√†m
                    <code>func_04</code>. ƒê·∫øn ƒë√¢y m√¨nh s·∫Ω bruteforce ƒë·ªÉ t√¨m ra <code>computer_name</code> nh∆∞ sau:
                </p>
                <ul>
                    <li>M√¨nh nh·∫≠n th·∫•y h√†m <code>func_04</code> bi·∫øn ƒë·ªïi chu·ªói b·∫±ng c√°ch bi·∫øn ƒë·ªïi t·ª´ng k√Ω t·ª± m·ªôt, n√™n
                        m√¨nh s·∫Ω bruteforce m·ªôt k√Ω t·ª± m·ªôt l·∫ßn.</li>
                    <li>Thu·∫≠t to√°n: v·ªõi m·ªói k√Ω t·ª± trong <code>computer_name</code>, cho <code>c</code> ch·∫°y trong t·∫≠p k√Ω
                        t·ª±, n·∫øu <code>bruteforce_function(c) == c</code> th√¨ ‚Äúch·ªçn‚Äù <code>c</code>, trong ƒë√≥
                        <code>bruteforce_function</code> l√† h√†m bi·∫øn ƒë·ªïi chu·ªói, n√≥i th·∫≥ng ra n√≥ ch√≠nh l√† h√†m
                        <code>func_04</code> (c√≥ s·ª≠a ƒë·ªïi 1 ch√∫t).
                    </li>
                </ul>
                <p>Code bruteforce:</p>
                <figure class="highlight python">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="comment"># python3</span></span><br><span class="line"></span><br><span class="line">chars = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyz-&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ror8</span>(<span class="params">n: <span class="built_in">int</span>, i: <span class="built_in">int</span></span>) -&gt; str:</span></span><br><span class="line">    i = i % <span class="number">8</span></span><br><span class="line">    n = n &amp; <span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">return</span> (n &gt;&gt; i) + ((n &lt;&lt; (<span class="number">8</span> - i)) &amp; <span class="number">0xFF</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">brute_one</span>(<span class="params">index: <span class="built_in">int</span></span>) -&gt; str:</span></span><br><span class="line">    <span class="keyword">assert</span> index &gt;= <span class="number">1</span> <span class="comment"># AutoIT uses 1-based index .</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;sprite.bmp&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.read(<span class="number">54</span>) <span class="comment"># discard</span></span><br><span class="line">        data = f.read()</span><br><span class="line">    start = <span class="number">7</span> * (index - <span class="number">1</span>)</span><br><span class="line">    tmp = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        tmp += ((data[start + i] &amp; <span class="number">1</span>) &lt;&lt; (<span class="number">7</span> - i))</span><br><span class="line">    tmp = ror8(tmp, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(c) == tmp:</span><br><span class="line">            <span class="keyword">return</span> c</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    r = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        r = r + brute_one(i + <span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span> (r)</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">aut01tfan1999</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>Sau ƒë√≥, ta patch h√†m <code>func_03</code> (h√†m n√†y l·∫•y <code>computer_name</code>), cho h√†m n√†y lu√¥n
                    return <code>&quot;aut01tfan1999&quot;</code>.</p>
                <p><img src="/images/flareon/6/9.png"></p>
                <p>Ch·∫°y th·ª≠ ch∆∞∆°ng tr√¨nh, nh·∫≠p 1 chu·ªói b·∫•t k·ª≥, r·ªìi b·∫•m ‚ÄúCan haz code?‚Äù, ta s·∫Ω nh·∫≠n ƒë∆∞·ª£c 1 ·∫£nh QR, qu√©t
                    ·∫£nh n√†y ta ƒë∆∞·ª£c:</p>
                <p><img src="/images/flareon/6/10.png"></p>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">L00ks_L1k3_Y0u_D1dnt_Run_Aut0_Tim3_0n_Th1s_0ne!@flare-on.com</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>


                <h1 id="7-re-crowd"><a href="#7-re-crowd" class="headerlink" title="7 - re_crowd">7 - re_crowd</a></h1>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">Hello,</span><br><span class="line"></span><br><span class="line">Here at Reynholm Industries we pride ourselves on everything. It&#39;s not easy to admit, but recently one of our most valuable servers was breached. We don&#39;t believe in host monitoring so all we have is a network packet capture. We need you to investigate and determine what data was extracted from the server, if any.</span><br><span class="line"></span><br><span class="line">Thank you</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p><img src="/images/flareon/7/1.png"></p>
                <p>·ªû b√†i n√†y ch√∫ng ta c√≥ 1 file .pcap, d√πng wireshark ƒë·ªÉ xem file n√†y:</p>
                <p><img src="/images/flareon/7/2.png"></p>
                <p>·ªû ƒë√¢y m√¨nh th·∫•y g√≥i s·ªë 7 c√≥ protocol l√† HTTP, n√™n m√¨nh s·∫Ω extract c√°c http object capture ƒë∆∞·ª£c nh∆∞
                    h√¨nh sau:</p>
                <p><img src="/images/flareon/7/3.png"></p>
                <p>Sau khi extract h·∫øt ra, ta c√≥ ƒë∆∞·ª£c file ‚Äú5c‚Äù l√† file n·∫∑ng nh·∫•t (11 kb), m·ªü n√≥ l√™n b·∫±ng Google chrome,
                    ta ƒë∆∞·ª£c m·ªôt webpage v·ªÅ ƒëo·∫°n chat c·ªßa m·ªôt s·ªë nh√¢n vi√™n trong c√¥ng ty.</p>
                <p><img src="/images/flareon/7/4.png"></p>
                <p>·ªû g·∫ßn cu·ªëi c·ªßa ƒëo·∫°n chat c√≥ 1 ƒëo·∫°n n√≥i chuy·ªán kh√° th√∫ v·ªã</p>
                <p><img src="/images/flareon/7/5.png"></p>
                <p>Theo h√¨nh tr√™n th√¨ Jen ƒë√£ l∆∞u danh s√°ch account ·ªü ‚ÄúC:\accounts.txt‚Äù, n√™n m√¨nh ƒëo√°n l√†, m√°y c√¥ng ty ƒë√£
                    b·ªã nhi·ªÖm malware n√†y, con malware n√†y ƒë√£ l·∫•y c·∫Øp file ‚Äúaccounts.txt‚Äù v√† g·ª≠i v·ªÅ cho attacker.</p>
                <p>B√¢y gi·ªù ta s·∫Ω v√†o ph√¢n t√≠ch c√°c g√≥i tin trong wireshark.</p>
                <p><img src="/images/flareon/7/6.png"></p>
                <p>·ªû tr√™n l√† m·ªôt g√≥i tin ƒë∆∞·ª£c g·ª≠i ƒë·∫øn server, ph∆∞∆°ng th·ª©c PROPFIND c≈©ng kh√° l·∫° so v·ªõi m√¨nh, n√™n m√¨nh ƒë√£
                    google ƒë·ªÉ t√¨m PROPFIND v√† t√¨m ƒë∆∞·ª£c m·ªôt s·ªë b√†i vi·∫øt hay ho.</p>
                <ul>
                    <li><a target="_blank" rel="noopener"
                            href="https://www.fortinet.com/blog/threat-research/buffer-overflow-attack-targeting-microsoft-iis-6-0-returns">Buffer
                            Overflow Attack Targeting Microsoft IIS 6.0 Returns</a></li>
                    <li><a target="_blank" rel="noopener"
                            href="https://www.trendmicro.com/en_us/research/17/c/iis-6-0-vulnerability-leads-code-execution.html">IIS
                            6.0 Vulnerability Leads to Code Execution</a></li>
                    <li><a target="_blank" rel="noopener"
                            href="https://github.com/edwardz246003/IIS_exploit/blob/master/exploit.py">Exploit
                            github</a></li>
                </ul>
                <p>Trong lo·∫°t b√†i tr√™n c√≥ ph√¢n t√≠ch r√µ v·ªÅ l·ªói Buffer Overflow d·∫´n ƒë·∫øn RCE. V√¨ v·∫≠y ta ch·ªâ c·∫ßn t·∫≠p trung
                    v√†o ƒëo·∫°n shellcode b·∫Øt ƒë·∫ßu t·ª´ ‚ÄúVVYAIAI‚Ä¶‚Äù.</p>
                <p>ƒêo·∫°n shellcode n√†y ch·ªâ bao g·ªìm c√°c k√≠ t·ª± ch·ªØ s·ªë, ch·ªØ th∆∞·ªùng v√† ch·ªØ in hoa n√™n m√¨nh nghƒ© ngay t·ªõi
                    Alphanumeric shellcode. ƒêo·∫°n shellcode tr√™n ƒë∆∞·ª£c t·∫°o ra b·∫±ng th∆∞ vi·ªán <a target="_blank"
                        rel="noopener"
                        href="https://github.com/un4ckn0wl3z/Alpha2-encoder/blob/master/alpha2.c">alpha2</a>.</p>
                <p><img src="/images/flareon/7/7.png"></p>
                <p>Ta vi·∫øt 1 ƒëo·∫°n code ƒë·ªÉ decode ƒëo·∫°n shellcode n√†y (l∆∞u √Ω ƒëo·∫°n shellcode n√†y l√† Unicode shellcode):</p>
                <figure class="highlight python">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="comment"># python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;shell.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        text = f.read().decode(<span class="string">&#x27;utf-16le&#x27;</span>)</span><br><span class="line">    text = text[text.find(<span class="string">&#x27;ZBABABABABkMAGB9u4JB&#x27;</span>) + <span class="built_in">len</span>(<span class="string">&#x27;ZBABABABABkMAGB9u4JB&#x27;</span>)::]</span><br><span class="line">    r = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(text) // <span class="number">2</span>):</span><br><span class="line">        x, y = <span class="built_in">ord</span>(text[<span class="number">2</span>*i]), <span class="built_in">ord</span>(text[<span class="number">2</span>*i+<span class="number">1</span>])</span><br><span class="line">        c, d = (x &amp; <span class="number">0xF0</span>) &gt;&gt; <span class="number">4</span>, x &amp; <span class="number">0xF</span></span><br><span class="line">        e, f = (y &amp; <span class="number">0xF0</span>) &gt;&gt; <span class="number">4</span>, y &amp; <span class="number">0xF</span></span><br><span class="line">        b = f</span><br><span class="line">        a = d + e</span><br><span class="line">        <span class="keyword">while</span> a &gt;= <span class="number">16</span>:</span><br><span class="line">            a = a - <span class="number">16</span></span><br><span class="line">        r += <span class="built_in">chr</span>((a&lt;&lt;<span class="number">4</span>) | b)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;dec.bin&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="built_in">bytearray</span>([<span class="built_in">ord</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> r]))</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;Done&#x27;</span>)</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>Trong ƒë√≥, shell.txt ch√≠nh l√† ƒëo·∫°n shellcode copy ra t·ª´ file .pcap.</p>
                <p>Ti·∫øp theo ta d√πng <a target="_blank" rel="noopener"
                        href="https://github.com/OALabs/BlobRunner">blobrunner</a> ƒë·ªÉ ch·∫°y v√† debug ƒëo·∫°n shellcode m·ªõi.
                </p>
                <blockquote>
                    <p>blobrunner l√† tool d√πng ƒë·ªÉ ch·∫°y 1 ƒëo·∫°n shellcode, d√πng ƒë·ªÉ debug c√°c shellcode d·ªÖ d√†ng h∆°n.</p>
                </blockquote>
                <p><img src="/images/flareon/7/8.png"></p>
                <p>shellcode m·ªõi c√≥ 1 pattern l·∫∑p ƒëi l·∫∑p l·∫°i r·∫•t nhi·ªÅu
                    <code>(push arg, push arg, push hash, call ebp)</code>:
                </p>
                <p><img src="/images/flareon/7/9.png"></p>
                <p>Ch·ªó ‚Äúcall ebp‚Äù s·∫Ω nh·∫£y ƒë·∫øn h√†m ·ªü 0x10000006, h√†m n√†y s·∫Ω t√≠nh hash c·ªßa c√°c h√†m Windows API, so s√°nh
                    v·ªõi hash ƒë∆∞·ª£c push l√™n stack. Sau khi t√¨m ƒë∆∞·ª£c h√†m c√≥ hash t∆∞∆°ng ·ª©ng, shellcode s·∫Ω nh·∫£y t·ªõi h√†m
                    Windows API ƒë√≥ qua l·ªánh ‚Äújmp eax‚Äù.</p>
                <p>ƒêo·∫°n shellcode n√†y kh√¥ng d√†i qu√°, nh∆∞ng m√¨nh l∆∞·ªùi ƒë·ªçc n√™n ƒë√£ l√†m nh∆∞ sau:</p>
                <ul>
                    <li>Breakpoint t·∫°i ‚Äújmp eax‚Äù.</li>
                    <li>Ch·∫°y shellcode.</li>
                    <li>Log l·∫°i nh·ªØng h√†m v√† tham s·ªë ƒë∆∞·ª£c g·ªçi ƒë·ªÉ c√≥ c√°i nh√¨n t·ªïng qu√°t v·ªÅ ch∆∞∆°ng tr√¨nh.</li>
                </ul>
                <p>V√† th·ª© t·ª± c√°c h√†m v√† tham s·ªë ƒë∆∞·ª£c g·ªçi nh∆∞ sau:</p>
                <ul>
                    <li><code>LoadLibraryA</code> , <code>&quot;ws2_32&quot;</code>.</li>
                    <li><code>WSAStartup</code>.</li>
                    <li><code>WSASocketA</code>, <code>AF_INET</code>, <code>SOCK_STREAM</code>, ‚Ä¶</li>
                    <li><code>WSAConnect</code>, <code>(random number) socket handle</code>,
                        <code>sockaddr (family: AF_INET, port: 4444, IP: 192.168.68.21)</code>.
                    </li>
                    <li>ƒê·∫øn ƒë√¢y ch∆∞∆°ng tr√¨nh kh√¥ng ch·∫°y n·ªØa, l√Ω do l√† v√¨ n√≥ c·ªë g·∫Øng k·∫øt n·ªëi ƒë·∫øn 192.168.68.21:4444 nh∆∞ng
                        kh√¥ng c√≥ server n√†o ·ªü ƒë·ªãa ch·ªâ n√†y c·∫£.</li>
                </ul>
                <p>Ta th·ª≠ t√¨m port 4444 trong wireshark.</p>
                <p><img src="/images/flareon/7/10.png"></p>
                <p>C√≥ 1 g√≥i tin t·ª´ 192.168.68.21:4444 g·ª≠i v·ªÅ server v·ªõi ƒë·ªô d√†i ph·∫ßn data l√† 1243 bytes.</p>
                <p>V·∫≠y ta d·ª±ng l·∫°i server ƒë·ªÉ gi·∫£ l·∫≠p g√≥i tin ƒë√≥, l√†m l·∫°i 1 l·∫ßn nh∆∞ tr√™n, nh∆∞ng ƒë·∫øn ƒëo·∫°n
                    <code>WSAConnect</code> th√¨ patch IP th√†nh 127.0.0.1 ƒë·ªÉ theo d√µi ti·∫øp xem n√≥ g·ªçi th√™m h√†m WinAPI
                    n√†o.
                </p>
                <p>Code server:</p>
                <figure class="highlight python">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="comment"># python3</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> a2b_hex</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.bind((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">4444</span>))</span><br><span class="line">    s.listen(<span class="number">5</span>)</span><br><span class="line">    c, v = s.accept()</span><br><span class="line">    data = <span class="string">&#x27;9c5c4f52a4b1037390e4c88e...&#x27;</span> <span class="comment"># truncated</span></span><br><span class="line">    data = a2b_hex(data)</span><br><span class="line">    c.send(data)</span><br><span class="line">    c.close()</span><br><span class="line">    s.close()</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;[+] Done&#x27;</span>)</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>Ch·∫°y l·∫°i v√† quan s√°t danh s√°ch c√°c h√†m WinAPI ƒë∆∞·ª£c g·ªçi (ch·ªâ li·ªát k√™ h√†m ƒë∆∞·ª£c g·ªçi sau
                    <code>WSAConnect</code>):
                </p>
                <ul>
                    <li><code>recv</code>, <code>(random number above) socket handle</code>, <code>buffer</code>,
                        <code>4</code>, <code>0</code>.
                    </li>
                    <li><code>VirtualAlloc</code>, <code>lpBase = 0</code>, <code>size = 0x4D7</code>,
                        <code>MEM_COMMIT</code>, <code>PAGE_EXECUTE_READWRITE</code>.
                    </li>
                    <li><code>recv</code>, <code>(random number above) socket handle</code>, <code>buffer</code>,
                        <code>0x4D7</code>, <code>0</code>.
                    </li>
                    <li>ƒê·∫øn ƒë√¢y ch∆∞∆°ng tr√¨nh l·∫°i kh√¥ng ch·∫°y n·ªØa, ƒë√£ ƒë·∫øn l√∫c ta ph·∫£i ph√¢n t√≠ch ƒëo·∫°n shellcode n√†y.</li>
                </ul>
                <p><img src="/images/flareon/7/11.png"></p>
                <p>Sau khi nh·∫≠n 0x4D7 byte, th√¨ d·ªØ li·ªáu ƒë√≥ ƒë∆∞·ª£c ƒë∆∞a v√†o trong h√†m m√† m√¨nh ƒë·∫∑t t√™n l√† ‚Äúdecr‚Äù ·ªü
                    0x10000143. Ta th·ª≠ xem h√†m ‚Äúdecr‚Äù n√†y c√≥ g√¨.</p>
                <p><img src="/images/flareon/7/12.png"></p>
                <p>ƒêo·∫°n code tr√™n ch√≠nh l√† RC4.</p>
                <blockquote>
                    <p>M·∫πo nh·∫≠n bi·∫øt RC4: nh√¨n th·∫•y ƒëo·∫°n code t∆∞∆°ng t·ª± nh∆∞
                        <code>for (i = 0; i &lt; 256; ++i) a[i] = i</code> , th√¨ g·∫ßn nh∆∞ ch·∫Øc ch·∫Øn l√† RC4, ƒë√≥ ch√≠nh l√† 1
                        trong c√°c b∆∞·ªõc t·∫°o key c·ªßa RC4.
                    </p>
                    <p>Trong ƒëo·∫°n code tr√™n, d√≤ng asm ·ªü ƒë·ªãa ch·ªâ <strong>0x10000144</strong> ch√≠nh l√† pattern n√≥i ·ªü tr√™n.
                    </p>
                </blockquote>
                <p>Key ·ªü l·∫ßn RC4 n√†y l√† ‚Äúkillervulture123‚Äù , ƒë∆∞·ª£c l·∫•y ·ªü thanh ghi esi (h√¨nh ·ªü d∆∞·ªõi):</p>
                <p><img src="/images/flareon/7/14.png"></p>
                <p>Sau khi RC4 decrypt ƒëo·∫°n data, th√¨ ta nh·∫≠n ƒë∆∞·ª£c m·ªôt ƒëo·∫°n shellcode m·ªõi, ƒëo·∫°n shellcode n√†y c≈©ng th·ª±c
                    hi·ªán vi·ªác dynamically resolve c√°c function ƒë·ªÉ ph·ª•c v·ª• vi·ªác g·ªçi c√°c h√†m WinAPI. Sau ƒë√≥, n√≥ th·ª±c hi·ªán
                    1 s·ªë c√¥ng vi·ªác hay ho:</p>
                <p><img src="/images/flareon/7/15.png"></p>
                <p>ƒê·∫ßu ti√™n l√† <code>CreateFile</code> <code>C:\\accounts.txt</code> v·ªõi quy·ªÅn ƒë·ªçc (GENERIC_READ). Ta
                    c≈©ng fake file ‚ÄúC:\accounts.txt‚Äù ƒë·ªÉ program c√≥ th·ªÉ ƒë·ªçc.</p>
                <p><img src="/images/flareon/7/16.png"></p>
                <p>Ti·∫øp theo, <code>ReadFile</code> ƒë·ªÉ ƒë·ªçc 0x100 bytes t·ª´ file n√†y.</p>
                <p>Sau ƒë√≥ ƒëo·∫°n data v·ª´a ƒë∆∞·ª£c ƒë·ªçc b·ªüi h√†m <code>ReadFile</code> l·∫°i ƒë∆∞·ª£c ƒë∆∞a v√†o 1 h√†m kh√°c ƒë·ªÉ m√£ ho√°, v√†
                    h√†m n√†y r·∫•t quen thu·ªôc:</p>
                <p><img src="/images/flareon/7/17.png"></p>
                <p>Kh√¥ng bi·∫øt b·∫°n ƒë·ªçc c√≥ th·∫•y pattern <code>&quot;for (i = 0; i &lt; 256; ++i) a[i] = i&quot;</code>
                    trong ƒëo·∫°n tr√™n kh√¥ng nh·ªâ ^^!.</p>
                <p>L·∫ßn n√†y key ƒë∆∞·ª£c push tr√™n stack: ‚Äúintrepidmango‚Äù.</p>
                <p>Ti·∫øp theo, m·ªôt socket m·ªõi l·∫°i ƒë∆∞·ª£c t·∫°o ra, connect t·ªõi 192.168.68.21:1337</p>
                <p><img src="/images/flareon/7/19.png"></p>
                <p>Nh∆∞ v·∫≠y, n·ªôi dung c·ªßa file s·∫Ω ƒë∆∞·ª£c RC4 encrypt tr∆∞·ªõc khi g·ª≠i v·ªÅ port 1337 cho attacker.</p>
                <p><strong>T√≥m l·∫°i, lu·ªìng th·ª±c thi c·ªßa ch∆∞∆°ng tr√¨nh nh∆∞ sau:</strong></p>
                <ul>
                    <li>Connect t·ªõi 192.168.68.21:4444 ƒë·ªÉ nh·∫≠n 1243 bytes d·ªØ li·ªáu.</li>
                    <li>D·ªØ li·ªáu v·ª´a nh·∫≠n ƒë∆∞·ª£c s·∫Ω ƒë∆∞·ª£c gi·∫£i m√£ RC4 b·∫±ng key ‚Äúkillervulture123‚Äù.</li>
                    <li>ƒêo·∫°n d·ªØ li·ªáu v·ª´a gi·∫£i m√£ ƒë∆∞·ª£c ch√≠nh l√† m·ªôt shellcode.</li>
                </ul>
                <p><strong>Sau ƒë√≥, ƒëo·∫°n shellcode tr√™n s·∫Ω ƒë∆∞·ª£c th·ª±c thi, lu·ªìng th·ª±c thi c·ªßa ƒëo·∫°n shellcode nh∆∞
                        sau:</strong></p>
                <ul>
                    <li>ƒê·ªçc file ‚ÄúC:\accounts.txt‚Äù.</li>
                    <li>D·ªØ li·ªáu v·ª´a ƒë·ªçc s·∫Ω ƒë∆∞·ª£c m√£ ho√° RC4 b·∫±ng key ‚Äúintrepidmango‚Äù.</li>
                    <li>D·ªØ li·ªáu v·ª´a ƒë∆∞·ª£c m√£ ho√° s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn server ·ªü 192.168.68.21:1337.</li>
                    <li>K·∫øt th√∫c.</li>
                </ul>
                <p>V·∫≠y vi·ªác cu·ªëi c√πng c·∫ßn l√†m l√†, l·∫•y data ƒë∆∞·ª£c g·ª≠i (·ªü port 1337) trong wireshark ra, decrypt v√† l·∫•y
                    flag.</p>
                <figure class="highlight python">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="comment"># python3</span></span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> a2b_hex</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC4</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    key = <span class="string">b&#x27;intrepidmango&#x27;</span></span><br><span class="line">    data = a2b_hex(<span class="string">b&#x27;truncated ...&#x27;</span>)</span><br><span class="line">    rc4 = ARC4.new(key)</span><br><span class="line">    d = rc4.decrypt(data)</span><br><span class="line">    <span class="built_in">print</span> (d)</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>Run:</p>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">b&#39;roy:h4ve_you_tri3d_turning_1t_0ff_and_0n_ag4in@flare-on.com:goat\r\nmoss:Pot-Pocket-Pigeon-Hunt-8:narwhal\r\njen:Straighten-Effective-Gift-Pity-1:bunny\r\nrichmond:Inventor-Hut-Autumn-Tray-6:bird\r\ndenholm:123:dog&#39;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">h4ve_you_tri3d_turning_1t_0ff_and_0n_ag4in@flare-on.com</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <blockquote>
                    <p>Fact: v√¨ RC4 l√† thu·∫≠t to√°n m√£ ho√° ƒë·ªëi x·ª©ng n√™n ta c√≥ th·ªÉ l·∫•y file b·ªã m√£ ho√° trong wireshark ra ƒë·ªÉ
                        l√†m gi·∫£ file ‚ÄúC:\accounts.txt‚Äù, khi ƒë√≥ program s·∫Ω m√£ ho√° file n√†y 1 l·∫ßn n·ªØa v√† cho ra lu√¥n file
                        g·ªëc.</p>
                </blockquote>
                <h1 id="8-Aardvark"><a href="#8-Aardvark" class="headerlink" title="8 - Aardvark">8 - Aardvark</a></h1>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">Expect difficulty running this one. I suggest investigating why each error is occuring. Or not, whatever. You do you.</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p><img src="/images/flareon/8/1.png"></p>
                <p>·ªû challenge n√†y ta c√≥ 1 file .exe, gi·∫£i n√©n file n√†y v√† ch·∫°y th·ª≠ (windows 7 VM):</p>
                <p><img src="/images/flareon/8/2.png"></p>
                <p>D√πng Detect it easy ƒë·ªÉ nh·∫≠n di·ªán file:</p>
                <p><img src="/images/flareon/8/3.png"></p>
                <p>ƒê·∫øn ƒë√¢y ta m·ªü file b·∫±ng IDA ƒë·ªÉ t√¨m xem nguy√™n nh√¢n g√¢y ra l·ªói ‚Äúsocket failed‚Äù nh∆∞ tr√™n h√¨nh l√† g√¨.
                </p>
                <figure class="highlight c++">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="function"><span class="keyword">int</span> __stdcall <span class="title">WinMain</span><span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, <span class="keyword">int</span> nShowCmd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS KEYPAD CTRL-&quot;+&quot; TO EXPAND]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// truncated ...</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  v8 = socket(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  v6 = v8;</span><br><span class="line">  <span class="keyword">if</span> ( v8 == <span class="number">-1</span>i64 )</span><br><span class="line">  &#123;</span><br><span class="line">    MessageBoxA(<span class="number">0</span>i64, <span class="string">&quot;socket failed&quot;</span>, <span class="string">&quot;Error&quot;</span>, <span class="number">0x10</span>u);</span><br><span class="line">    v9 = <span class="string">&quot;Error creating Unix domain socket&quot;</span>;</span><br><span class="line">LABEL_16:</span><br><span class="line">    MessageBoxA(<span class="number">0</span>i64, v9, <span class="string">&quot;Error&quot;</span>, <span class="number">0x10</span>u);</span><br><span class="line">    <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// truncated ...</span></span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>Ta ƒë·ªÉ √Ω d√≤ng:</p>
                <figure class="highlight c">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">v8 = socket(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>); <span class="comment">// socket(AF_UNIX, SOCK_STREAM, 0);</span></span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>Theo m√¨nh bi·∫øt th√¨ AF_UNIX ch·ªâ xu·∫•t hi·ªán tr√™n c√°c h·ªá ƒëi·ªÅu h√†nh UNIX, nh∆∞ng ·ªü c√°c b·∫£n c·∫≠p nh·∫≠t Windows
                    g·∫ßn ƒë√¢y, Microsoft ƒë√£ th√™m n√≥ v√†o h·ªá ƒëi·ªÅu h√†nh Windows 10, <a target="_blank" rel="noopener"
                        href="https://devblogs.microsoft.com/commandline/af_unix-comes-to-windows/">xem ·ªü ƒë√¢y</a>.</p>
                <p>V√¨ v·∫≠y m√¨nh ƒë√£ t·∫£i b·∫£n Windows 10 version 1909 v·ªÅ ƒë·ªÉ ch·∫°y l·∫°i file n√†y, v√† nh·∫≠n ƒë∆∞·ª£c k·∫øt qu·∫£:</p>
                <p><img src="/images/flareon/8/4.png"></p>
                <p>Ta quay l·∫°i IDA, xem strings window ƒë·ªÉ t√¨m d√≤ng tr√™n:</p>
                <p><img src="/images/flareon/8/5.png"></p>
                <p>D√πng xref ƒë·ªÉ ƒëi t·ªõi h√†m <code>sub_140001B10</code> (h√†m n√†y s·ª≠ d·ª•ng chu·ªói ‚ÄúCoCreateInstance failed‚Äù).
                </p>
                <figure class="highlight c++">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">__int64 __usercall sub_140001B10@&lt;rax&gt;(__int64 a1@&lt;rcx&gt;, <span class="keyword">unsigned</span> <span class="keyword">int</span> a2@&lt;edx&gt;, __int64 a3@&lt;r8&gt;, __int128 *_XMM0@&lt;xmm0&gt;)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS KEYPAD CTRL-&quot;+&quot; TO EXPAND]</span></span><br><span class="line"></span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  v5 = a3;</span><br><span class="line">  ppv = <span class="number">0</span>i64;</span><br><span class="line">  v6 = a2;</span><br><span class="line">  v13 = <span class="number">0</span>i64;</span><br><span class="line">  v7 = a1;</span><br><span class="line">  <span class="keyword">if</span> ( CoCreateInstance(&amp;rclsid, <span class="number">0</span>i64, <span class="number">4u</span>, &amp;riid, &amp;ppv) )</span><br><span class="line">  &#123;</span><br><span class="line">    MessageBoxA(<span class="number">0</span>i64, <span class="string">&quot;CoCreateInstance failed&quot;</span>, <span class="string">&quot;Error&quot;</span>, <span class="number">0x10</span>u);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( (*(*ppv + <span class="number">96</span>i64))(ppv, &amp;v14) )</span><br><span class="line">  &#123;</span><br><span class="line">    MessageBoxA(<span class="number">0</span>i64, <span class="string">&quot;GetDefaultDistribution failed&quot;</span>, <span class="string">&quot;Error&quot;</span>, <span class="number">0x10</span>u);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( (*(*ppv + <span class="number">24</span>i64))(ppv, &amp;v14, <span class="number">0</span>i64, &amp;unk_14001E028, &amp;v13) )</span><br><span class="line">  &#123;</span><br><span class="line">    MessageBoxA(<span class="number">0</span>i64, <span class="string">&quot;CreateInstance failed&quot;</span>, <span class="string">&quot;Error&quot;</span>, <span class="number">0x10</span>u);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v11 = <span class="number">0</span>;</span><br><span class="line">    v10 = <span class="number">0</span>;</span><br><span class="line">    GetCurrentDirectoryW(<span class="number">0x105</span>u, &amp;Buffer);</span><br><span class="line">    v15 = <span class="number">0</span>i64;</span><br><span class="line">    v16 = <span class="number">0</span>i64;</span><br><span class="line">    v12 = *(*(*(__readgsqword(<span class="number">0x30</span>u) + <span class="number">96</span>) + <span class="number">32</span>i64) + <span class="number">16</span>i64);</span><br><span class="line">    <span class="keyword">if</span> ( (*(*v13 + <span class="number">48</span>i64))(v13, v7, v6, v5, <span class="number">0</span>, <span class="number">0</span>i64, &amp;Buffer, <span class="number">0</span>i64, <span class="number">0</span>i64, <span class="number">0</span>, <span class="number">0</span>, &amp;v15, &amp;v12, <span class="number">0</span>, &amp;v11, &amp;v10) )</span><br><span class="line">      MessageBoxA(<span class="number">0</span>i64, <span class="string">&quot;CreateLxProcess failed&quot;</span>, <span class="string">&quot;Error&quot;</span>, <span class="number">0x10</span>u);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v4 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v13 )</span><br><span class="line">    (*(*v13 + <span class="number">16</span>i64))(v13);</span><br><span class="line">  <span class="keyword">if</span> ( ppv )</span><br><span class="line">    (*(*ppv + <span class="number">16</span>i64))(ppv);</span><br><span class="line">  <span class="keyword">return</span> v4;</span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>·ªû ƒë√¢y ta th·∫•y c√≥ string ‚ÄúCreateLxProcess failed‚Äù n√™n ta th·ª≠ t√¨m Github h√†m n√†y:</p>
                <p><img src="/images/flareon/8/6.png"></p>
                <p>Sau m·ªôt l√∫c xem qua c√°c k·∫øt qu·∫£ th√¨ m√¨nh th·∫•y:</p>
                <ul>
                    <li>T√™n repository n√†y l√† ‚ÄúWSLReverse‚Äù, (WSL l√† ‚ÄúWindows Subsystem for Linux‚Äù <a target="_blank"
                            rel="noopener" href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">Link</a>).
                    </li>
                    <li>Link <a target="_blank" rel="noopener"
                            href="https://github.com/Biswa96/WslReverse/tree/a6133642a7d9b0e1f033d047c96c49cb731c5abf">github</a>.
                    </li>
                </ul>
                <p>V·∫≠y kh·∫£ nƒÉng cao file b·ªã l·ªói l√† do ch∆∞a c√†i ƒë·∫∑t WSL, n√™n ta c√†i ƒë·∫∑t <a target="_blank" rel="noopener"
                        href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">WSL</a> tr√™n Windows 10 , r·ªìi
                    ch·∫°y l·∫°i file:</p>
                <p><img src="/images/flareon/8/7.png"></p>
                <p>Ta ƒë∆∞·ª£c 1 game Tic-tac-toe, m√† computer ƒë√£ ƒëi tr∆∞·ªõc 1 n∆∞·ªõc ·ªü ngay gi·ªØa, t·ª©c l√† g·∫ßn nh∆∞ ch√∫ng ta ch·ªâ
                    c√≥ th·ªÉ h√≤a ho·∫∑c thua, ch∆°i th·ª≠ 1 v√†i tr·∫≠n, ƒëi·ªÅu ·ªü tr√™n ƒë∆∞·ª£c x√°c nh·∫≠n.</p>
                <p>Quay l·∫°i IDA ƒë·ªÉ ph√¢n t√≠ch code.</p>
                <p>ƒê·∫ßu ti√™n, ch∆∞∆°ng tr√¨nh t·∫°o ra 1 <code>socket(AF_UNIX, ...)</code> ƒë·ªÉ l·∫Øng nghe:</p>
                <figure class="highlight c++">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">v8 = socket(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"> v6 = v8;</span><br><span class="line"> <span class="keyword">if</span>...</span><br><span class="line"> <span class="keyword">if</span> ( bind(v8, &amp;name, <span class="number">110</span>) == <span class="number">-1</span> )</span><br><span class="line">   v10 = <span class="string">&quot;bind failed&quot;</span>;</span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line"> &#123;</span><br><span class="line">   <span class="keyword">if</span> ( listen(v6, <span class="number">0x7FFFFFFF</span>) != <span class="number">-1</span> )</span><br><span class="line">     <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">   v10 = <span class="string">&quot;listen failed&quot;</span>;</span><br><span class="line"> &#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>Ti·∫øp theo ch∆∞∆°ng tr√¨nh th·ª±c hi·ªán h√†m <code>sub_140012B0</code>, trong h√†m n√†y, n√≥ l·∫•y resource ra v√†
                    ghi ra th∆∞ m·ª•c ‚Äú%tmp%‚Äù.</p>
                <figure class="highlight c++">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="function">__int64 <span class="title">sub_1400012B0</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS KEYPAD CTRL-&quot;+&quot; TO EXPAND]</span></span><br><span class="line"></span><br><span class="line">  v11 = &amp;v13;</span><br><span class="line">  v12 = <span class="number">0</span>i64;</span><br><span class="line">  NumberOfBytesWritten[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  v0 = <span class="number">0</span>;</span><br><span class="line">  v1 = <span class="number">-1</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( !GetTempFileNameA(<span class="string">&quot;.&quot;</span>, PrefixString, <span class="number">0</span>, &amp;FileName) )</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">  wsprintfA(&amp;v13, <span class="string">&quot;%s&quot;</span>, &amp;FileName);</span><br><span class="line">  *sub_140003268((__int64)&amp;v13, <span class="string">&#x27;\\&#x27;</span>) = <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">  v1 = (__int64)CreateFileA(&amp;FileName, <span class="number">0x40000000</span>u, <span class="number">0</span>, <span class="number">0</span>i64, <span class="number">3u</span>, <span class="number">0x80</span>u, <span class="number">0</span>i64); <span class="comment">// GENERIC_WRITE</span></span><br><span class="line"><span class="comment">// ....</span></span><br><span class="line">  v3 = FindResourceA(<span class="number">0</span>i64, (LPCSTR)<span class="number">0x12C</span>, (LPCSTR)<span class="number">0x100</span>);</span><br><span class="line">  v4 = v3;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line">  v6 = SizeofResource(<span class="number">0</span>i64, v3);</span><br><span class="line">  v7 = LoadResource(<span class="number">0</span>i64, v4);</span><br><span class="line">  v5 = v7;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line">  v8 = LockResource(v7);</span><br><span class="line">  <span class="keyword">if</span> ( WriteFile((HANDLE)v1, v8, v6, NumberOfBytesWritten, <span class="number">0</span>i64) &amp;&amp; NumberOfBytesWritten[<span class="number">0</span>] == v6 )</span><br><span class="line">  &#123;</span><br><span class="line">    CloseHandle((HANDLE)v1);</span><br><span class="line">    FreeResource(v5);</span><br><span class="line">    sub_140001930((__int64)&amp;v13, <span class="number">1u</span>, (__int64)&amp;v11); <span class="comment">// &lt;---- here</span></span><br><span class="line">    v0 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>Ti·∫øp theo ch∆∞∆°ng tr√¨nh nh·∫£y v√†o h√†m <code>sub_140001930</code>, h√†m n√†y s·∫Ω d·ª±a v√†o s·ªë build c·ªßa
                    Windows ƒë·ªÉ ti·∫øp t·ª•c th·ª±c thi:</p>
                <figure class="highlight c++">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="keyword">if</span> ( GetVersionExA(&amp;VersionInformation) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( VersionInformation.dwBuildNumber &gt;= <span class="number">0x42EE</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( VersionInformation.dwBuildNumber == <span class="number">17134</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_140001AB0();</span><br><span class="line">        sub_140001B10(v3, v5, v4, <span class="number">0</span>i64);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>i64;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( VersionInformation.dwBuildNumber == <span class="number">17763</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_140001AB0();</span><br><span class="line">        sub_140001D60(v3, v5, v4);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>i64;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( VersionInformation.dwBuildNumber - <span class="number">18362</span> &lt;= <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_140001AB0();</span><br><span class="line">        sub_140001FB0(v3, v5, v4);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>i64;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( VersionInformation.dwBuildNumber - <span class="number">19041</span> &lt;= <span class="number">1</span> || VersionInformation.dwBuildNumber &gt; <span class="number">0x4A62</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_140001AB0();</span><br><span class="line">        sub_1400021E0(v3, v5, v4);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>i64;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>M√°y m√¨nh l√† Windows 10 build 18363, n√™n m√¨nh s·∫Ω ti·∫øp t·ª•c ƒëi v√†o h√†m <code>sub_140001FB0</code>:</p>
                <figure class="highlight c++">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_140001FB0</span><span class="params">(__int64 a1, <span class="keyword">unsigned</span> <span class="keyword">int</span> a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  v4 = a3;</span><br><span class="line">  ppv = <span class="number">0</span>i64;</span><br><span class="line">  v5 = a2;</span><br><span class="line">  v6 = a1;</span><br><span class="line">  <span class="keyword">if</span> ( CoCreateInstance(&amp;rclsid, <span class="number">0</span>i64, <span class="number">4u</span>, &amp;riid, &amp;ppv) )</span><br><span class="line">  &#123;</span><br><span class="line">    MessageBoxA(<span class="number">0</span>i64, <span class="string">&quot;CoCreateInstance failed&quot;</span>, <span class="string">&quot;Error&quot;</span>, <span class="number">0x10</span>u);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( (*(*ppv + <span class="number">88</span>i64))(ppv, &amp;v18) )</span><br><span class="line">  &#123;</span><br><span class="line">    MessageBoxA(<span class="number">0</span>i64, <span class="string">&quot;GetDefaultDistribution failed&quot;</span>, <span class="string">&quot;Error&quot;</span>, <span class="number">0x10</span>u);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v17 = <span class="number">0</span>i64;</span><br><span class="line">    v16 = <span class="number">0</span>i64;</span><br><span class="line">    v20 = <span class="number">0</span>i64;</span><br><span class="line">    v19 = <span class="number">0</span>i64;</span><br><span class="line">    v15 = <span class="number">0</span>i64;</span><br><span class="line">    v14 = <span class="number">0</span>i64;</span><br><span class="line">    v13 = <span class="number">0</span>i64;</span><br><span class="line">    v12 = <span class="number">0</span>i64;</span><br><span class="line">    v7 = *(*(*(__readgsqword(<span class="number">0x30</span>u) + <span class="number">96</span>) + <span class="number">32</span>i64) + <span class="number">16</span>i64);</span><br><span class="line">    GetCurrentDirectoryW(<span class="number">0x105</span>u, &amp;Buffer);</span><br><span class="line">    v10 = <span class="number">0</span>;</span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( (*(*ppv + <span class="number">112</span>i64))(ppv,&amp;v18,v6,v5,v4,&amp;Buffer,<span class="number">0</span>i64,<span class="number">0</span>i64,<span class="number">0</span>,<span class="string">L&quot;root&quot;</span>,</span><br><span class="line">           v9,v10,v7,&amp;v19,&amp;v22,&amp;v21,&amp;v17,&amp;v16,&amp;v15,&amp;v14,&amp;v13,&amp;v12) )</span><br><span class="line">    &#123;</span><br><span class="line">      MessageBoxA(<span class="number">0</span>i64, <span class="string">&quot;CreateLxProcess failed&quot;</span>, <span class="string">&quot;Error&quot;</span>, <span class="number">0x10</span>u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v3 = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( ppv )</span><br><span class="line">  &#123;</span><br><span class="line">    (*(*ppv + <span class="number">16</span>i64))(ppv);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v3;</span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>Trong ƒëo·∫°n code tr√™n:</p>
                <figure class="highlight c++">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="keyword">if</span> ( (*(*ppv + <span class="number">112</span>i64))(ppv,&amp;v18,v6,v5,v4,&amp;Buffer,<span class="number">0</span>i64,<span class="number">0</span>i64,<span class="number">0</span>,<span class="string">L&quot;root&quot;</span>,</span><br><span class="line">       v9,v10,v7,&amp;v19,&amp;v22,&amp;v21,&amp;v17,&amp;v16,&amp;v15,&amp;v14,&amp;v13,&amp;v12) )</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>ƒêo·∫°n code n√†y g·ªçi h√†m trong vtable c·ªßa object C++, ta v√†o link respository tr√™n, ƒë·ªçc file <a
                        target="_blank" rel="noopener"
                        href="https://github.com/Biswa96/WslReverse/blob/a6133642a7d9b0e1f033d047c96c49cb731c5abf/common/LxssUserSession.h">LxssUserSession.h</a>
                </p>
                <p><img src="/images/flareon/8/8.png"></p>
                <p>Ta c√≥ th·ªÉ th·∫•y s·ª± t∆∞∆°ng ƒë·ªìng, v·∫≠y ta c√≥ th·ªÉ k·∫øt lu·∫≠n ƒë√¢y l√† h√†m <code>CreateLxProcess</code>.</p>
                <p>V·∫≠y h√†m <code>CreateLxProcess</code> l√†m g√¨ ?</p>
                <p>·ªû windows 10, khi WSL ra ƒë·ªùi, ta ƒë√£ c√≥ th·ªÉ ch·∫°y c√°c file executable (ELF) tr√™n h·ªá ƒëi·ªÅu h√†nh linux, v√≠
                    d·ª• nh∆∞ cat, ls, ‚Ä¶</p>
                <p>Nh∆∞ng ƒë∆∞·ªùng d·∫´n t·ªõi file n√†y n·∫±m ·ªü ƒë√¢u ? Ta nh·ªõ l·∫°i l√∫c n√£y ch∆∞∆°ng tr√¨nh c√≥ l·∫•y resource c·ªßa n√≥ r·ªìi
                    ghi ra ‚Äú%tmp%‚Äù, n√™n ta d√πng ‚ÄúResource hacker‚Äù extract resource n√†y ra xem th·ª≠:</p>
                <blockquote>
                    <p>Resource hacker l√† tool d√πng ƒë·ªÉ xem v√† s·ª≠a ph·∫ßn resource c·ªßa file PE, t·∫£i ·ªü <a target="_blank"
                            rel="noopener" href="http://www.angusj.com/resourcehacker/">ƒë√¢y</a>.</p>
                </blockquote>
                <p><img src="/images/flareon/8/9.png"></p>
                <p>Ta th·∫•y 1 file b·∫Øt ƒë·∫ßu v·ªõi <code>\x7FELF</code>, ch√≠nh l√† file executable c·ªßa h·ªá ƒëi·ªÅu h√†nh linux. Ta
                    extract file n√†y ra v√† b·ªè v√†o IDA:</p>
                <figure class="highlight c++">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS KEYPAD CTRL-&quot;+&quot; TO EXPAND]</span></span><br><span class="line"></span><br><span class="line">  addr.sa_data[<span class="number">13</span>] = <span class="number">0</span>;</span><br><span class="line">  v47 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v43 = <span class="number">0L</span>L;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v42, <span class="number">0</span>, <span class="number">0x58</span>uLL);</span><br><span class="line">  addr.sa_family = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">strcpy</span>(addr.sa_data, <span class="string">&quot;496b9b4b.ed5&quot;</span>);</span><br><span class="line">  v3 = socket(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  fd = v3;</span><br><span class="line">  <span class="keyword">if</span> ( v3 &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    perror(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v4 = &amp;addr;</span><br><span class="line">    v5 = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3;</span><br><span class="line">    <span class="keyword">if</span> ( connect(v3, &amp;addr, <span class="number">0x6E</span>u) &gt;= <span class="number">0</span> )</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>V·∫≠y ch∆∞∆°ng tr√¨nh m·ªõi ƒë∆∞·ª£c drop ra s·∫Ω <code>connect</code> t·ªõi socket ƒë∆∞·ª£c t·∫°o b·ªüi file .exe.</p>
                <p>Ph√¢n t√≠ch c·∫£ 2 file .exe v√† file ELF, ta c√≥ th·ªÉ th·∫•y ƒë√¢y l√† 1 game Tic-tac-toe theo c·∫•u tr√∫c
                    Client-Server, n·∫øu Server th·∫Øng, Client s·∫Ω b·∫Øt ƒë·∫ßu t·∫°o 1 message t·ª´ /proc/modules, /proc/mounts,
                    /proc/version_signature, ‚Ä¶ r·ªìi g·ª≠i cho Server. </p>
                <p>Nh∆∞ng nh∆∞ ph√¢n t√≠ch ·ªü ban ƒë·∫ßu, th√¨ Server kh√¥ng bao gi·ªù th·∫Øng ƒë∆∞·ª£c v√¨ Client ƒë√£ ƒëi tr∆∞·ªõc 1 n∆∞·ªõc ·ªü
                    ngay ch√≠nh gi·ªØa, c√°ch duy nh·∫•t ƒë·ªÉ th·∫Øng ch√≠nh l√† b·∫±ng c√°ch n√†o ƒë√≥ patch Client ƒë·ªÉ Server c√≥ c∆° h·ªôi
                    th·∫Øng.</p>
                <p>·ªû Server, khi ta click v√†o 1 √¥, n√≥ s·∫Ω g·ª≠i t·ªça ƒë·ªô c·ªßa √¥ ƒë√≥ (x,y) cho Client (h√†m
                    <code>DialogFunc</code> ·ªü 0x140001000):
                </p>
                <figure class="highlight c++">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="keyword">if</span> ( qword_14001EA78[v22] == <span class="number">32</span> )</span><br><span class="line">&#123;</span><br><span class="line">  ::buf = a3 &gt;&gt; <span class="number">4</span>;</span><br><span class="line">  v23 = s;</span><br><span class="line">  byte_14001EA71 = a3 &amp; <span class="number">0xF</span>;</span><br><span class="line">  qword_14001EA78[v22] = <span class="number">79</span>;</span><br><span class="line">  send(v23, &amp;::buf, <span class="number">2</span>, <span class="number">0</span>); <span class="comment">// &lt;----- send X,Y here</span></span><br><span class="line">  recv(s, qword_14001EA78, <span class="number">10</span>, <span class="number">0</span>);</span><br><span class="line">  sub_140001520(v4);</span><br><span class="line">  <span class="keyword">if</span> ( byte_14001EA81 )</span><br><span class="line">  &#123;</span><br><span class="line">    recv(s, &amp;buf, <span class="number">64</span>, <span class="number">0</span>);</span><br><span class="line">    MessageBoxA(v4, &amp;buf, <span class="string">&quot;Game Over&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    sub_1400014E0();</span><br><span class="line">    sub_140001520(v4);</span><br><span class="line">  &#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>·ªû Client, tr∆∞·ªõc khi g·ª≠i tr·∫°ng th√°i c·ªßa game cho Server, n√≥ s·∫Ω ki·ªÉm tra xem v·ªõi n∆∞·ªõc ƒëi ƒë√≥ th√¨ c√≥ ai
                    ‚Äúth·∫Øng‚Äù kh√¥ng (tr·∫°ng th√°i c·ªßa game l√† 1 chu·ªói 10 k√Ω t·ª±, trong ƒë√≥ 9 k√Ω t·ª± ƒë·∫ßu l√† ‚ÄúXXOOXO‚Ä¶‚Äù t√πy v√†o
                    c√°c n∆∞·ªõc ƒëi, k√Ω t·ª± cu·ªëi ƒë·ªÉ x√°c ƒë·ªãnh xem ai l√† ng∆∞·ªùi th·∫Øng v·ªõi tr·∫°ng th√°i hi·ªán t·∫°i)</p>
                <figure class="highlight c++">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"><span class="comment">// function &quot;main&quot; on Client</span></span><br><span class="line">v4[<span class="number">3</span> * v6 + i] = <span class="number">88</span>;</span><br><span class="line">byte_2020A9 = sub_14B0();</span><br><span class="line">send(fd, &amp;byte_2020A0, <span class="number">0xA</span>uLL, <span class="number">0</span>); <span class="comment">// send state</span></span><br><span class="line">v5 = byte_2020A9;</span><br><span class="line"><span class="keyword">if</span> ( byte_2020A9 )</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line">recv(fd, &amp;unk_2020AA, <span class="number">2u</span>LL, <span class="number">0</span>);</span><br><span class="line">v15 = &amp;v4[<span class="number">3</span> * unk_2020AA + byte_2020AB];</span><br><span class="line"><span class="keyword">if</span> ( *v15 != <span class="number">32</span> )</span><br><span class="line">  <span class="keyword">goto</span> LABEL_5;</span><br><span class="line">*v15 = <span class="number">79</span>;</span><br><span class="line">v5 = sub_14B0();   <span class="comment">// check if someone wins, return &#x27;X&#x27;, &#x27;O&#x27;, or 0</span></span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>V·∫≠y ta ch·ªâ c·∫ßn breakpoint ngay t·∫°i h√†m <code>send</code> c·ªßa Client, s·ª≠a State l·∫°i tr∆∞·ªõc khi n√≥ g·ª≠i
                    ƒë·ªÉ l·ª´a Client.</p>
                <p>ƒê·∫ßu ti√™n, m√¨nh d√πng plugin gef cho gdb, t·∫£i ·ªü <a target="_blank" rel="noopener"
                        href="https://gef.readthedocs.io/en/master/">ƒë√¢y</a>.</p>
                <p>C√°ch debug process ch·∫°y b·ªüi WSL:</p>
                <ul>
                    <li>
                        <p>Ch·∫°y ttt2.exe.</p>
                    </li>
                    <li>
                        <p>M·ªü 1 windows terminal kh√°c l√™n, g√µ WSL ƒë·ªÉ truy c·∫≠p v√†o Linux Subsystem.</p>
                    </li>
                    <li>
                        <p>G√µ ps -aux ƒë·ªÉ l·∫•y list c√°c process trong Linux Subsystem.</p>
                        <p><img src="/images/flareon/8/10.png"></p>
                    </li>
                    <li>
                        <p>Ta th·∫•y process ƒëang ch·∫°y d∆∞·ªõi t√™n ‚ÄúXXXX.tmp‚Äù, gi·ªù ta attach debugger v√†o b·∫±ng l·ªánh ‚Äúsudo gdb
                            -p 9‚Äù, v√¨ PID c·ªßa n√≥ l√† 9. (xem ·ªü c·ªôt PID).</p>
                    </li>
                    <li>
                        <p>G√µ ‚Äúvmmap‚Äù trong gdb ƒë·ªÉ t√¨m base address c·ªßa ‚ÄúXXXX.tmp‚Äù.</p>
                        <p><img src="/images/flareon/8/11.png"></p>
                    </li>
                    <li>
                        <p>Nh∆∞ h√¨nh tr√™n, base address s·∫Ω l√† 0x00007fe9e6200000.</p>
                    </li>
                    <li>
                        <p>V√†o IDA l·∫•y Offset:</p>
                        <figure class="highlight plain">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><span class="line">1</span><br></pre>
                                    </td>
                                    <td class="code">
                                        <pre><span class="line">.text:0000000000000D47                 call    sub_14B0        ; check</span><br></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </li>
                    <li>
                        <p>V·∫≠y Offset l√† 0xD47, ta g√µ ‚Äúb *0x00007fe9e6200000+0xD47‚Äù ƒë·ªÉ ƒë·∫∑t breakpoint ngay t·∫°i ch·ªó n√†y.
                        </p>
                    </li>
                    <li>
                        <p>G√µ c ƒë·ªÉ ch∆∞∆°ng tr√¨nh ti·∫øp t·ª•c ch·∫°y.</p>
                    </li>
                    <li>
                        <p>B√™n Server, ta click v√†o b·∫•t k·ª≥ √¥ n√†o (tr·ª´ √¥ gi·ªØa), khi ƒë√≥ Client ƒë√£ d·ª´ng l·∫°i ngay t·∫°i
                            breakpoint.</p>
                    </li>
                    <li>
                        <p>State ·ªü Client l√† 1 m·∫£ng char, global, offset t·∫°i 0x2020A0, ta d√πng l·ªánh sau ƒë·ªÉ patch state:
                            <code>patch string 0x00007fe9e6200000+0x2020A0 &quot;OOOOOOOOO&quot;</code> (9 ch·ªØ ‚ÄúO‚Äù).
                        </p>
                    </li>
                    <li>
                        <p>B·∫•m c ƒë·ªÉ cho Client ch·∫°y ti·∫øp, ·ªü Server ta nh·∫≠n ƒë∆∞·ª£c 1 message.</p>
                        <p><img src="/images/flareon/8/12.png"></p>
                    </li>
                </ul>
                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">c1ArF&#x2F;P2CjiDXQIZ@flare-on.com</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p>‚Äì</p>

            </div>
        </article>




        <div id="footer-post-container">
            <div id="footer-post">

                <div id="nav-footer" style="display: none">
                    <ul>

                        <li><a href="/">home</a></li>

                        <li><a href="/about/">about</a></li>

                        <li><a href="/archives/">articles</a></li>

                        <li><a target="_blank" rel="noopener"
                                href="https://cyberjutsu.io/publications/">publications</a></li>

                    </ul>
                </div>

                <div id="toc-footer" style="display: none">
                    <ol class="toc">
                        <li class="toc-item toc-level-2"><a class="toc-link" href="#Phan-2"><span
                                    class="toc-number">1.</span> <span class="toc-text">Ph·∫ßn 2</span></a></li>
                    </ol>
                    </li>
                    <li class="toc-item toc-level-1"><a class="toc-link" href="#4-report"><span
                                class="toc-number"></span> <span class="toc-text">4 - report</span></a></li>
                    <li class="toc-item toc-level-1"><a class="toc-link" href="#5-TKApp"><span
                                class="toc-number"></span> <span class="toc-text">5 - TKApp</span></a></li>
                    <li class="toc-item toc-level-1"><a class="toc-link" href="#6-codeit"><span
                                class="toc-number"></span> <span class="toc-text">6 - codeit</span></a></li>
                    <li class="toc-item toc-level-1"><a class="toc-link" href="#7-re-crowd"><span
                                class="toc-number"></span> <span class="toc-text">7 - re_crowd</span></a></li>
                    <li class="toc-item toc-level-1"><a class="toc-link" href="#8-Aardvark"><span
                                class="toc-number"></span> <span class="toc-text">8 - Aardvark</span></a>
                </div>

                <div id="share-footer" style="display: none">
                    <ul>
                        <li><a class="icon" target="_blank" rel="noopener"
                                href="http://www.facebook.com/sharer.php?u=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/"><i
                                    class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
                        <li><a class="icon" target="_blank" rel="noopener"
                                href="https://twitter.com/share?url=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&text=FLAREON 2020 - WRITEUP PH·∫¶N 2"><i
                                    class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
                        <li><a class="icon" target="_blank" rel="noopener"
                                href="http://www.linkedin.com/shareArticle?url=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&title=FLAREON 2020 - WRITEUP PH·∫¶N 2"><i
                                    class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
                        <li><a class="icon" target="_blank" rel="noopener"
                                href="https://pinterest.com/pin/create/bookmarklet/?url=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&is_video=false&description=FLAREON 2020 - WRITEUP PH·∫¶N 2"><i
                                    class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
                        <li><a class="icon"
                                href="mailto:?subject=FLAREON 2020 - WRITEUP PH·∫¶N 2&body=Check out this article: https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/"><i
                                    class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
                        <li><a class="icon" target="_blank" rel="noopener"
                                href="https://getpocket.com/save?url=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&title=FLAREON 2020 - WRITEUP PH·∫¶N 2"><i
                                    class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
                        <li><a class="icon" target="_blank" rel="noopener"
                                href="http://reddit.com/submit?url=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&title=FLAREON 2020 - WRITEUP PH·∫¶N 2"><i
                                    class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
                        <li><a class="icon" target="_blank" rel="noopener"
                                href="http://www.stumbleupon.com/submit?url=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&title=FLAREON 2020 - WRITEUP PH·∫¶N 2"><i
                                    class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
                        <li><a class="icon" target="_blank" rel="noopener"
                                href="http://digg.com/submit?url=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&title=FLAREON 2020 - WRITEUP PH·∫¶N 2"><i
                                    class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
                        <li><a class="icon" target="_blank" rel="noopener"
                                href="http://www.tumblr.com/share/link?url=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&name=FLAREON 2020 - WRITEUP PH·∫¶N 2&description="><i
                                    class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
                        <li><a class="icon" target="_blank" rel="noopener"
                                href="https://news.ycombinator.com/submitlink?u=https://blog.cyberjutsu.io/2020/12/24/flareon-phan-2/&t=FLAREON 2020 - WRITEUP PH·∫¶N 2"><i
                                    class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
                    </ul>

                </div>

                <div id="actions-footer">
                    <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i
                            class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
                    <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i
                            class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
                    <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i
                            class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
                    <a id="top" style="display:none" class="icon" href="#"
                        onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg"
                            aria-hidden="true"></i> Top</a>
                </div>

            </div>
        </div>


        <footer id="footer">
            <div class="footer-left">
                Copyright &copy;


                2020-2021 -
                CyberJutsu Team
            </div>
            <div class="footer-right">
                <nav>
                    <ul>

                        <li><a href="/">home</a></li>

                        <li><a href="/about/">about</a></li>

                        <li><a href="/archives/">articles</a></li>

                        <li><a target="_blank" rel="noopener"
                                href="https://cyberjutsu.io/publications/">publications</a></li>

                    </ul>
                </nav>
            </div>
        </footer>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-50645715-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());

            gtag('config', 'UA-50645715-1');
        </script>

    </div>
    <!-- styles -->

    <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


    <link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

    <script src="/lib/jquery/jquery.min.js"></script>


    <script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

    <!-- clipboard -->


    <script src="/lib/clipboard/clipboard.min.js"></script>

    <script type="text/javascript">
        $(function () {
            // copy-btn HTML
            var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
            btn += '<i class="far fa-clone"></i>';
            btn += '</span>';
            // mount it!
            $(".highlight table").before(btn);
            var clip = new ClipboardJS('.btn-copy', {
                text: function (trigger) {
                    return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str, it) => str + it.innerText + '\n', '')
                }
            });
            clip.on('success', function (e) {
                e.trigger.setAttribute('aria-label', "Copied!");
                e.clearSelection();
            })
        })
    </script>


    <script src="/js/main.js"></script>

    <!-- search -->

    <!-- Google Analytics -->

    <!-- Baidu Analytics -->

    <!-- Umami Analytics -->

    <!-- Disqus Comments -->


</body>

</html>